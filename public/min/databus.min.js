var databusApplication=angular.module("databusApplication",["angular-content-editable","dndLists","angular-click-outside"]).factory("collectionManager",["$http",function(e){return new DatabusCollectionManager(e,"databus_collections")}]).factory("focus",["$timeout","$window",function(e,t){return function(i){e((function(){var e=t.document.getElementById(i);e&&e.focus()}))}}]).controller("HeaderController",["$scope","$http","collectionManager",HeaderController]).controller("AccountPageController",["$scope","$http","$location",AccountPageController]).controller("FrontPageController",["$scope","$sce",FrontPageController]).controller("ArtifactPageController",["$scope","$sce","collectionManager",ArtifactPageController]).controller("CollectionController",["$scope","$sce","$http","collectionManager",CollectionController]).controller("CollectionsEditorController",["$scope","$timeout","$http","$location","collectionManager",CollectionsEditorController]).controller("DocumentationController",["$scope","$sce",DocumentationController]).controller("GroupPageController",["$scope","$http","$sce","$interval","collectionManager",GroupPageController]).controller("ProfileController",["$scope","$http",ProfileController]).controller("PublishWizardController",["$scope","$http","focus","$q",PublishWizardController]).controller("VersionPageController",["$scope","$sce","collectionManager",VersionPageController]).directive("uploadRanking",(function(){return{restrict:"E",replace:!0,templateUrl:"/website/templates/upload-ranking.html",scope:{data:"=data"}}}));databusApplication.config((function(e){e.html5Mode({enabled:!0,requireBase:!1,rewriteLinks:!1})})),databusApplication.component("overrideCheckbox",{templateUrl:"/js/components/override-checkbox/override-checkbox.html",controller:OverrideCheckboxController,bindings:{checkValue:"<",label:"<",id:"<",readonly:"<",isOverride:"<",onChange:"&"}}),databusApplication.component("entityCard",{templateUrl:"/js/components/entity-card/entity-card.html",controller:["$sce",EntityCardController],bindings:{label:"<",uri:"<",desc:"<",date:"<",type:"<",imageUrl:"<"}}),databusApplication.component("search",{templateUrl:"/js/components/search/search.html",controller:["$http","$interval","$sce",SearchController]}),databusApplication.component("autofillDropdown",{templateUrl:"/js/components/autofill-dropdown/autofill-dropdown.html",controller:["$timeout",AutofillDropdownController],bindings:{input:"=",values:"<",isDisabled:"<",placeholder:"@",onChange:"&"}}),databusApplication.component("databusIcon",{templateUrl:"/js/components/databus-icon/databus-icon.html",controller:DatabusIconController,bindings:{size:"<",shape:"<",onClick:"&",isClickable:"<",color:"<"}}),databusApplication.component("artifactCard",{templateUrl:"/js/components/artifact-card/artifact-card.html",controller:ArtifactCardController,bindings:{artifact:"<"}}),databusApplication.component("typeTag",{templateUrl:"/js/components/type-tag/type-tag.html",controller:TypeTagController,bindings:{type:"<",height:"<",width:"<"}}),databusApplication.component("collectionEditor",{templateUrl:"/js/components/collection-editor/collection-editor.html",controller:["$http","$location","$sce",CollectionEditorController],bindings:{collection:"=",readonly:"<",onPublish:"&",onDelete:"&",loggedIn:"<"}}),databusApplication.component("collectionEditorWidget",{templateUrl:"/js/components/collection-editor-widget/collection-editor-widget.html",controller:["collectionManager","$scope",CollectionEditorWidgetController],bindings:{selection:"<",collection:"="}}),databusApplication.component("collectionHierarchy",{templateUrl:"/js/components/collection-hierarchy/collection-hierarchy.html",controller:["$http","$location","$sce",CollectionHierarchyController],bindings:{collection:"=",readonly:"<",onPublish:"&",onDelete:"&",loggedIn:"<",onChange:"&"}}),databusApplication.component("collectionHierarchyTwo",{templateUrl:"/js/components/collection-hierarchy-two/collection-hierarchy.html",controller:["$http","$location","$sce","$scope",CollectionHierarchyControllerTwo],bindings:{collection:"=",onChange:"&"}}),databusApplication.component("collectionNode",{templateUrl:"/js/components/collection-node/collection-node.html",controller:CollectionNodeController,bindings:{node:"<",readonly:"<",onRemoveNode:"&",onClick:"&",count:"<",isExpandable:"<"}}),databusApplication.component("collectionSearch",{templateUrl:"/js/components/collection-search/collection-search.html",controller:["collectionManager","$http","$interval","$sce",CollectionSearchController],bindings:{collection:"=",onComponentAdded:"&"}}),databusApplication.component("collectionStatistics",{templateUrl:"/js/components/collection-statistics/collection-statistics.html",controller:["$http","$scope","$location","$sce",CollectionStatisticsController],bindings:{collection:"<"}}),databusApplication.component("collectionStatus",{templateUrl:"/js/components/collection-status/collection-status.html",controller:["$http","$location","$sce",CollectionStatusController],bindings:{hasLocalChanges:"<",isPublished:"<",isDraft:"<"}}),databusApplication.component("databusSearch",{templateUrl:"/js/components/databus-search/databus-search.html",controller:["$http","$interval","$sce",DatabusSearchController],bindings:{filters:"=",input:"="}}),databusApplication.component("editLabel",{templateUrl:"/js/components/edit-label/edit-label.html",controller:["$element",EditLabelController],bindings:{text:"=",singleLine:"<",onBlur:"&",onChange:"&"}}),databusApplication.component("expandableArrow",{templateUrl:"/js/components/expandable-arrow/expandable-arrow.html",controller:ExpandableArrowController,bindings:{expanded:"=",onChange:"&",isReadonly:"<"}}),databusApplication.component("facetsView",{templateUrl:"/js/components/facets-view/facets-view.html",controller:["$http","$scope",FacetsViewController],bindings:{node:"=",readonly:"<",resourceType:"@",onChange:"&",onLoaded:"&"}}),databusApplication.component("facetsViewHorizontal",{templateUrl:"/js/components/facets-view/facets-view-horizontal.html",controller:["$http","$scope",FacetsViewController],bindings:{node:"=",readonly:"<",resourceType:"@",onChange:"&",onLoaded:"&"}}),databusApplication.component("fileBrowser",{templateUrl:"/js/components/file-browser/file-browser.html",controller:["$http","$scope",FileBrowserController],bindings:{resourceUri:"<",resourceType:"@",facetSettings:"<",parentFacetSettings:"<",query:"<",fullQuery:"<",config:"<"}}),databusApplication.component("multiselectArtifactDropdown",{templateUrl:"/js/components/multiselect-artifact-dropdown/multiselect-artifact-dropdown.html",controller:["$timeout","$sce",MultiselectArtifactDropdownController],bindings:{data:"<",node:"<",values:"<",isDisabled:"<",icon:"<",onChange:"&"}}),databusApplication.component("multiselectDropdown",{templateUrl:"/js/components/multiselect-dropdown/multiselect-dropdown.html",controller:["$timeout","$sce",MultiselectDropdownController],bindings:{parentInput:"<",input:"=",values:"<",isDisabled:"<",placeholder:"@",onChange:"&"}}),databusApplication.component("tableEditor",{templateUrl:"/js/components/table-editor/table-editor.html",controller:TableEditorController,bindings:{model:"=",onRemoveFile:"&",onAnalyzeFile:"&",analysisProcesses:"<"}}),databusApplication.component("uriBreadcrumbs",{templateUrl:"/js/components/uri-breadcrumbs/uri-breadcrumbs.html",controller:UriBreadcrumbsController,bindings:{uri:"<"}}),databusApplication.component("yasqeText",{templateUrl:"/js/components/yasqe-text/yasqe-text.html",controller:["$scope","$element",YasqeTextController],bindings:{query:"=",readOnly:"<",onChange:"&"}}),databusApplication.component("collectionDataTable",{templateUrl:"/js/components/collection-data-table/collection-data-table.html",controller:["$http","$scope","$location","$sce",CollectionDataTableController],bindings:{collection:"<"}}),databusApplication.directive("selectOnClick",["$window",function(e){return{restrict:"A",link:function(t,i,a){i.on("click",(function(){e.getSelection().toString()||0!=this.readonly||this.setSelectionRange(0,this.value.length)}))}}}]),databusApplication.directive("focusMe",["$timeout","$parse",function(e,t){return{link:function(i,a,o){var n=t(o.focusMe);i.$watch(n,(function(t){!0===t&&e((function(){a[0].focus()}))}))}}}]),databusApplication.directive("eventFocus",(function(e){return function(t,i,a){i.on(a.eventFocus,(function(){e(a.eventFocusId)})),t.$on("$destroy",(function(){i.off(a.eventFocus)}))}})),databusApplication.directive("uploaderRanking",(function(){return{restrict:"E",replace:!0,template:'<div><table class="table is-size-6 is-fullwidth"><thead><tr><th>Consumer</th><th>Uploads</th><th>Derived Data (GByte)</th></tr></thead><tbody><tr ng-repeat="row in data"><td><a href="{{ row.accountUri }}">{{ row.account }}</a></td><td>{{ row.numUploads }}</td><td>{{ row.uploadSize }}</td></tr></tbody></table></div>',scope:{data:"=data"}}})),databusApplication.directive("groupsTable",(function(){return{restrict:"E",replace:!0,template:'<div><table class="table is-size-6 is-fullwidth"><thead><tr><th>Group Id</th><th># Artifacts</th></tr></thead><tbody><tr ng-repeat="row in data"><td><a href="{{ row.uri }}">{{ row.label }}</a></td><td>{{ row.artifactCount }}</td></tr></tbody></table></div>',scope:{data:"=data"}}})),databusApplication.directive("activityChart",(function(){return{restrict:"E",replace:!0,template:'<svg class="chart"></svg>',scope:{data:"=data",height:"=height"},link:function(e,t,i){var a=e.height;for(d in e.data)e.data[d].date=new Date(e.data[d].date);var o=d3.select(t[0]).attr("id","graph").attr("width","100%").attr("height",a),n=20,r=50,s=o.node().getBoundingClientRect().width-r-50,l=a-n-60,c=o.append("g").attr("transform","translate("+r+","+n+")"),u=d3.scaleTime().rangeRound([0,s]),h=d3.scaleLinear().rangeRound([l,0]),f=d3.line().x((function(e){return u(e.date)})).y((function(e){return h(e.value)}));u.domain(d3.extent(e.data,(function(e){return e.date}))),h.domain(d3.extent(e.data,(function(e){return e.value}))),c.append("g").attr("transform","translate(0,"+l+")").call(d3.axisBottom(u)).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start"),c.append("g").call(d3.axisLeft(h)).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y",6).attr("dy","1em").attr("font-size","1.1em").attr("text-anchor","end").text("Uploaded Data (GByte)");c.append("path").datum(e.data).attr("fill","none").attr("stroke","steelblue").attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",2).attr("d",f)}}})),databusApplication.directive("onFinishRender",["$timeout","$parse",function(e,t){return{restrict:"A",link:function(i,a,o){!0===i.$last&&e((function(){i.$emit("ngRepeatFinished"),o.onFinishRender&&t(o.onFinishRender)(i)}))}}}]);class DatabusCollectionManager{constructor(e,t){this.storageKey=t,this.http=e,this.remote=this.loadCollectionsFromStorage(!1),this.local=this.loadCollectionsFromStorage(!0)}initialize(e){this.remote={};let t={};for(let i in this.local){if(!i.startsWith("___")){delete this.local[i];continue}if(i!==this.local[i].uuid){delete this.local[i];continue}let a=this.local[i];if(void 0!==a.uri&&void 0!==e){let o=a.uri;void 0===e[o]?(delete this.local[i].uri,delete this.local[i].issued,delete this.local[i].created):(t[o]=!0,this.remote[i]=e[o],this.local[i].publisher=e[o].publisher,this.local[i].issued=e[o].issued,this.local[i].created=e[o].created,this.local[i].files=e[o].files)}}for(let i in e)if(void 0===t[i]){let t=DatabusCollectionUtils.uuidv4();e[i].uuid=t,this.local[t]=DatabusCollectionUtils.createCleanCopy(e[i]),this.remote[t]=DatabusCollectionUtils.createCleanCopy(e[i])}for(let e in this.local)this.local[e]=new DatabusCollectionWrapper(this.local[e]),this.local[e].content instanceof Object||(this.local[e].content={groups:[],customQueries:[]});let i=window.localStorage.getItem(this.storageKey+"_active");void 0!==this.local[i]&&(this.activeCollectionIdentifier=i),window.sessionStorage.setItem(this.storageKey+"_isInitialized","true"),null==this.activeCollection&&this.selectFirstOrCreate(),QueryNode.assignParents(this.activeCollection.content.generatedQuery.root),this.saveLocally(),void 0!==this.initialized&&this.initialized()}findActive(){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized1.";this.activeCollectionIdentifier=window.localStorage.getItem(this.storageKey+"_active"),null==this.activeCollection&&this.selectFirstOrCreate()}get isInitialized(){return"true"===window.sessionStorage.getItem(this.storageKey+"_isInitialized")}loadCollectionsFromStorage(e=!0){let t;!0===e&&(t=JSON.parse(window.localStorage.getItem(this.storageKey))),!1===e&&(t=JSON.parse(window.sessionStorage.getItem(this.storageKey))),null==t&&(t={});for(let e in t)void 0===e||"undefined"===e?delete t[e]:t[e]=new DatabusCollectionWrapper(t[e]);return t}selectFirstOrCreate(){this.activeCollectionIdentifier=null;for(let e in this.local){this.activeCollectionIdentifier=e;break}null==this.activeCollection&&this.createNew("Unnamed Collection","",(function(e){}))}setActive(e){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized1.";this.convertCollectionContentToTree(e);let t=this.local[e];QueryNode.assignParents(t.content.generatedQuery.root),this.activeCollectionIdentifier=e,window.localStorage.setItem(this.storageKey+"_active",this.activeCollectionIdentifier)}get activeCollection(){return null==this.activeCollectionIdentifier?null:this.local[this.activeCollectionIdentifier]}convertCollectionContentToTree(e){let t=this.local[e];if(void 0===t.content.generatedQuery)for(var i in t.content.generatedQuery={},t.content.generatedQuery.root=new QueryNode(null,null),t.content.groups){var a=t.content.groups[i],o=new QueryNode(a.uri,"dataid:group");for(var n in a.settings){var r=a.settings[n];"SYSTEM_LATEST_ARTIFACT_VERSION"!==r.value&&"SYSTEM_LATEST_GROUP_VERSION"!==r.value||(r.value="$latest"),o.setFacet(r.facet,r.value,r.checked)}for(var s in t.content.generatedQuery.root.addChild(o),a.artifacts){var l=a.artifacts[s],c=new QueryNode(l.uri,"dataid:artifact");o.addChild(c)}}}createSnapshot(e){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";let t=DatabusCollectionWrapper.createNew();t.content=DatabusCollectionUtils.createCleanCopy(e.content);let i=t.content.generatedQuery.root;for(var a in i.childNodes){var o=i.childNodes[a];for(var n in o.facetSettings)"$latest"===o.facetSettings[n][0].value&&this.http.get("/system/pages/facets",{params:{uri:s.uri,type:"group"}}).then((function(e){let t=e.data["http://purl.org/dc/terms/hasVersion"].values.reduce((function(e,t){return e>t?e:t}));s.facetSettings[n][0].value=t}));for(var r in o.childNodes){var s=o.childNodes[r];for(var n in s.facetSettings)"$latest"===s.facetSettings[n][0].value&&this.http.get("/system/pages/facets",{params:{uri:s.uri,type:"artifact"}}).then((function(e){let t=e.data["http://purl.org/dc/terms/hasVersion"].values.reduce((function(e,t){return e>t?e:t}));s.facetSettings[n][0].value=t}))}}return t.label=`Snapshot of ${e.label}`,t.description=e.description,t.abstract=e.abstract,this.local[t.uuid]=new DatabusCollectionWrapper(t),this.saveLocally(),this.setActive(t.uuid),t}saveLocally(){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";null!=this.activeCollection&&(this.activeCollection.hasLocalChanges=this.hasLocalChanges(this.activeCollection));try{window.localStorage.setItem(this.storageKey,DatabusCollectionUtils.serialize(this.local)),window.sessionStorage.setItem(this.storageKey,DatabusCollectionUtils.serialize(this.remote))}catch(e){console.log(e)}}hasLocalChanges(e){if(void 0===this.remote[e.uuid])return!0;let t=this.remote[e.uuid],i=DatabusCollectionUtils.serialize(t.content),a=DatabusCollectionUtils.serialize(e.content);return e.label!==t.label||e.abstract!==t.abstract||e.description!==t.description||a!==i}discardLocalChanges(e){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";let t=this.activeCollection.uuid;if(void 0===this.remote[t])return;let i=this.activeCollection.uri;null!=i&&(null!=e&&null!=e[i]&&(this.remote[t]=DatabusCollectionUtils.createCleanCopy(e[i])),this.local[t].label=this.remote[t].label,this.local[t].abstract=this.remote[t].abstract,this.local[t].description=this.remote[t].description,this.local[t].content=DatabusCollectionUtils.createCleanCopy(this.remote[t].content),this.local[t].hasLocalChanges=this.hasLocalChanges(this.local[t]))}addElement(e){this.current.addElement(e),this.saveLocally(),null!=this.onactiveCollectionChanged&&this.onactiveCollectionChanged(this.current)}removeElement(e){this.current.removeElement(e),this.saveLocally(),null!=this.onactiveCollectionChanged&&this.onactiveCollectionChanged(this.current)}createNew(e,t,i){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";if(void 0===e||!/^\w+[\w\s]*$/.test(e))return void i(!1);let a=DatabusCollectionWrapper.createNew(e,t);this.local[a.uuid]=new DatabusCollectionWrapper(a),this.setActive(a.uuid),this.saveLocally(),i(!0)}createDraft(e){if(!this.isInitialized)return;let t=DatabusCollectionWrapper.createNew("","");this.local[t.uuid]=new DatabusCollectionWrapper(t),this.setActive(t.uuid),this.saveLocally(),e(DatabusResponse.COLLECTION_DRAFT_CREATED)}createCopy(e){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";let t=DatabusCollectionWrapper.createNew();return t.content=DatabusCollectionUtils.createCleanCopy(e.content),t.label=`Copy of ${e.label}`,t.description=e.description,t.abstract=e.abstract,this.local[t.uuid]=new DatabusCollectionWrapper(t),this.saveLocally(),this.setActive(t.uuid),t}deleteLocally(e){delete this.local[this.activeCollection.uuid],this.selectFirstOrCreate(),this.saveLocally(),e({code:909})}getCollectionByUri(e){if(null==e)return null;for(let t in this.local)if(e===this.local[t].uri)return this.local[t];return null}getFirstCollection(){return 0===this.local.length?null:this.local[0]}async changeCollection(e,t,i,a=!1){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";this.saveLocally();var o=this.activeCollection.uuid,n=`/${e}/collections/${t}`,r=`${DATABUS_RESOURCE_BASE_URL}/${e}#this`,s=encodeURIComponent(DatabusCollectionUtils.serialize(this.activeCollection.content,["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published","uuid"]));let i={"@context":JSONLD_CONTEXT,"@graph":[{"@id":DATABUS_RESOURCE_BASE_URL+n,"@type":"databus:Collection",publisher:r,title:this.activeCollection.label,abstract:this.activeCollection.abstract,description:this.activeCollection.description,"databus:content":s}]};a&&(i["@graph"][0].issued=(new Date).toISOString());var l=null;try{l=await this.http.put(n,i)}catch(e){throw console.log(e),{code:e.data.code}}var c=l.data.data[0];if(this.activeCollection.uuid!=o)throw{code:DatabusResponse.COLLECTION_INVALID_ARGUMENT};return this.remote[o]=JSON.parse(DatabusCollectionUtils.serialize(this.activeCollection)),this.local[o].uri=c["@id"],this.local[o].hasLocalChanges=this.hasLocalChanges(this.local[o]),this.saveLocally(),l.data}catch(e){throw{code:void 0!==e.data&&void 0!==e.data.code?e.data.code:DatabusResponse.COLLECTION_UPDATE_ERROR}}}async commitCollection(e,t){return await this.changeCollection(e,t,"put")}async updateCollection(e,t){return await this.changeCollection(e,t,"patch")}async unHideCollection(e,t){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";var i=await this.changeCollection(e,t,"patch",!0),a=this.getCollectionByUri(i.data[0]["@id"]);return this.remote[a.uuid].issued=i.data[0]["http://purl.org/dc/terms/issued"][0]["@value"],this.local[a.uuid].issued=i.data[0]["http://purl.org/dc/terms/issued"][0]["@value"],this.saveLocally(),{code:i.code}}catch(e){throw{code:void 0!==e.data&&void 0!==e.data.code?e.data.code:DatabusResponse.COLLECTION_UPDATE_ERROR}}}async hideCollection(e,t){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";var i=await this.changeCollection(e,t,"patch"),a=this.getCollectionByUri(i.data[0]["@id"]);return delete this.remote[a.uuid].issued,delete this.local[a.uuid].issued,this.saveLocally(),{code:i.code}}catch(e){throw{code:void 0!==e.data&&void 0!==e.data.code?e.data.code:DatabusResponse.COLLECTION_UPDATE_ERROR}}}async fetchCollection(e){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";var t={method:"GET",url:e,headers:{Accept:"application/json"}},i=await this.http(t),a=getCollectionByUri(e);this.local[a.uuid].content=i.data.content,this.local[a.uuid].created=i.data.created,this.local[a.uuid].issued=i.data.issued,this.local[a.uuid].label=i.data.label,this.local[a.uuid].abstract=i.data.abstract,this.local[a.uuid].description=i.data.description,this.local[a.uuid].files=i.data.files}catch(e){return console.log(e),e.data}}async deleteCollection(e,t){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";let a=this.activeCollection.uuid;if(this.activeCollection.isDraft)return delete this.local[a],{code:DatabusResponse.COLLECTION_DELETED};let o=this.activeCollection.uri;DatabusCollectionUtils.uriToName(o);var i=`/${e}/collections/${t}`;let n=await this.http.delete(i);return delete this.remote[a],delete this.local[a],n.data}catch(e){return console.log(e),e.data}}}class DatabusCollectionUtils{static checkCollectionForm(e,t){var i=!1;return this.checkLabel(t.label,1,200)?e.label.error=null:(i=!0,null==t.label||""==t.label?e.label.error=DatabusResponse.COLLECTION_MISSING_LABEL:e.label.error=DatabusResponse.COLLECTION_INVALID_LABEL),this.checkText(t.abstract,50,500)?e.abstract.error=null:(i=!0,null==t.abstract||""==t.abstract?e.abstract.error=DatabusResponse.COLLECTION_MISSING_ABSTRACT:e.abstract.error=DatabusResponse.COLLECTION_INVALID_ABSTRACT),this.checkText(t.description,50,0)?e.description.error=null:(i=!0,null==t.description||""==t.description?e.description.error=DatabusResponse.COLLECTION_MISSING_DESCRIPTION:e.description.error=DatabusResponse.COLLECTION_INVALID_DESCRIPTION),!i}static checkIdentifier(e){return this.checkField(e,/^[a-z0-9_-]+$/,1,50)}static checkText(e,t,i){return this.checkField(e,/^[\x00-\x7F\n]*$/,t,i)}static checkLabel(e,t,i){return this.checkField(e,/^[A-Za-z0-9\s_()\.\,\-]*$/,t,i)}static checkField(e,t,i,a){return null!=e&&(!(a>0&&e.length>a)&&(!(e.length<i)&&t.test(e)))}static checkCollectionTexts(e){var t=/^[\x00-\x7F\n]*$/;return null==e.label||""==e.label?DatabusResponse.COLLECTION_MISSING_LABEL:!/^[\x00-\x7F]*$/.test(e.label)||e.label.length>200?DatabusResponse.COLLECTION_INVALID_LABEL:null==e.abstract||""==e.abstract?DatabusResponse.COLLECTION_MISSING_ABSTRACT:!t.test(e.abstract)||e.abstract.length<50||e.abstract.length>500?DatabusResponse.COLLECTION_INVALID_ABSTRACT:null==e.description||""==e.description?DatabusResponse.COLLECTION_MISSING_DESCRIPTION:!t.test(e.description)||description.description.length<50?DatabusResponse.COLLECTION_INVALID_DESCRIPTION:0}static uuidv4(){return"___xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}static uriToName(e){if(null==e)return null;var t=e.substr(e.lastIndexOf("/")+1);return t=t.substr(t.lastIndexOf("#")+1)}static navigateUp(e){return e.substr(0,e.lastIndexOf("/"))}static copyStringToClipboard(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style={position:"absolute",left:"-9999px"},document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}static createQueryString(e){return new DatabusCollectionWrapper(e).createQuery()}static reduceBinding(e){for(var t in e)e[t]=e[t].value;return e}static async getCollectionStatistics(e,t){let i=(new QueryBuilder).createQuery(t.content.generatedQuery.root,DATABUS_QUERIES.collectionStatistics,"%COLLECTION_QUERY%",2);if(null==i)return null;var a={method:"POST",url:DATABUS_SPARQL_ENDPOINT_URL,data:"format=json&query="+encodeURIComponent(i),headers:{"Content-type":"application/x-www-form-urlencoded"}},o=(await e(a)).data.results.bindings;if(0===o.length)return null;let n={fileCount:o.length,licenses:[],files:[],size:0};for(let e in o){let t=DatabusCollectionUtils.reduceBinding(o[e]);n.size+=parseInt(t.size),n.licenses.push(t.license),n.files.push(t)}return n.licenses=n.licenses.filter((function(e,t,i){return i.indexOf(e)===t})),n}static async getCollectionFiles(e,t){let i=(new QueryBuilder).createQuery(t.content.generatedQuery.root,DATABUS_QUERIES.collectionFiles,"%COLLECTION_QUERY%",2);var a={method:"POST",url:DATABUS_SPARQL_ENDPOINT_URL,data:"format=json&query="+encodeURIComponent(i),headers:{"Content-type":"application/x-www-form-urlencoded"}},o=(await e(a)).data.results.bindings;if(0===o.length)return null;let n=[];for(let e in o){let t=DatabusCollectionUtils.reduceBinding(o[e]);n.push(t)}return n}static serialize(e,t){return null==t&&(t=["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published"]),JSON.stringify(e,(function(e,i){if(!t.includes(e))return i}))}static createCleanCopy(e){return JSON.parse(DatabusCollectionUtils.serialize(e))}static exportToJsonFile(e){let t=DatabusCollectionUtils.serialize(e,["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published","uuid"]),i="data:application/json;charset=utf-8,"+encodeURIComponent(t),a=document.createElement("a");a.setAttribute("href",i),a.setAttribute("download","data.json"),a.click()}}"object"==typeof module&&module&&module.exports&&(module.exports=DatabusCollectionUtils);class DatabusCollectionWrapper{constructor(e){Object.assign(this,e),this.eventListeners={}}addEventListener(e,t){null==this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)}isPublisher(e){return null!=this.uri&&this.uri.startsWith("https://databus.dbpedia.org/"+e)}get isPublished(){return null!=this.issued}get displayLabelHtml(){var e="";return this.isDraft&&(e+='<span style="color: #8a8cb3; margin-right:4px">DRAFT:</span>'),e+=null!=this.label&&this.label.length>0?this.label:"Untitled Collection"}get isDraft(){return void 0===this.uri}fireEvent(e){if(null!=this.eventListeners[e])for(var t in this.eventListeners[e]){(0,this.eventListeners[e][t])()}}static createNew(e,t){var i={};return i.label=e,i.description=t,i.content={},i.content.groups=[],i.content.customQueries=[],i.uuid=DatabusCollectionUtils.uuidv4(),i}createQuery(){return new QueryBuilder("PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\n\n# Get all files\nSELECT DISTINCT ?file WHERE {\n \t?dataset dataid:artifact <%ARTIFACT_URI%> .\n\t?dataset dcat:distribution ?distribution .%OPTIONS%\n\t?distribution dcat:downloadURL ?file .\n}","%ARTIFACT_URI%","%OPTIONS%").createCollectionQuery(this.content)}downloadAsJson(){var e="data:text/json;charset=utf-8,"+encodeURIComponent(angular.toJson(this)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",this.label+".json"),document.body.appendChild(t),t.click(),t.remove()}removeCustomQueryNode(e){this.content.customQueries=this.content.customQueries.filter((function(t){return e.guid!=t.guid}))}removeNodeByUri(e){QueryNode.removeChildByUri(this.content.generatedQuery.root,e)}removeGroupNode(e){this.content.groups=this.content.groups.filter((function(t){return e.uri!=t.uri}))}addCustomQueryNode(e,t){this.content.customQueries.push({guid:DatabusCollectionUtils.uuidv4(),label:e,query:t})}hasGroup(e){return null!=this.findGroup(e)}hasArtifact(e){var t=DatabusCollectionUtils.navigateUp(e),i=this.findGroup(t);return null!=i&&null!=this.findArtifact(i,e)}addGroupNode(e,t){var i=this.findGroup(e);if(null==i){var a=DatabusCollectionUtils.navigateUp(e),o=DatabusCollectionUtils.uriToName(e),n=DatabusCollectionUtils.uriToName(a);(i={}).uri=e,i.artifacts=[],i.label=n+" » "+o,i.settings=t,i.expanded=!0,this.content.groups.push(i),this.fireEvent("onGroupAdded")}return i}addArtifactNode(e,t,i){var a=DatabusCollectionUtils.navigateUp(e),o=this.addGroupNode(a,[{facet:"http://purl.org/dc/terms/hasVersion",value:"SYSTEM_LATEST_ARTIFACT_VERSION",checked:!0}]),n=this.findArtifact(o,e);null==n&&((n={}).uri=e,n.label=t,n.settings=i,o.artifacts.push(n),this.fireEvent("onArtifactAdded"))}findGroup(e){for(var t in this.content.groups){var i=this.content.groups[t];if(i.uri==e)return i}return null}findArtifact(e,t){for(var i in e.artifacts){var a=e.artifacts[i];if(a.uri==t)return a}return null}}const QUERY_DEFAULT_SELECTION="SELECT DISTINCT ?file WHERE\n{ %COLLECTION_QUERY% \n }",QUERY_DEFAULT_SELECTION_PLACEHOLDER="%COLLECTION_QUERY%";class QueryBuilder{constructor(e,t,i){this.stringSuffix="",this.artifactBaseQuery=e,this.artifactUriPlaceholder=t,this.optionsPlaceholder=i,this.queryPlaceholderFacet="%FACET%",this.queryPlaceholderValue="%VALUE%",this.defaultSubquery=`\n\t{ ?distribution <%FACET%> '%VALUE%'${this.stringSuffix}. }`}extractPrefixes(e,t){var i=t.match(/PREFIX\s+[^\s]+\s+[^\s]+/g);for(var a in i){var o=i[a].split(/\s+/g);e[o[1]]=o[2]}}static hasCustomQueries(e){return null!=e.customQueries&&e.customQueries.length>0}static hasGeneratedQuery(e){return null!=e.generatedQuery&&null!=e.generatedQuery.root&&null!=e.generatedQuery.root.childNodes&&e.generatedQuery.root.childNodes.length>0}static hasContent(e){return!!QueryBuilder.hasCustomQueries(e)||!!QueryBuilder.hasGeneratedQuery(e)}static assignParents(e){for(var t=0;t<e.childNodes.length;t++)e.childNodes[t].parent=e,QueryBuilder.assignParents(e.childNodes[t])}createCollectionQuery(e,t,i){null==t&&(t=QUERY_DEFAULT_SELECTION),null==i&&(i="%COLLECTION_QUERY%");var a={};if(!QueryBuilder.hasContent(e))return this.emptyFallback;for(var o in e.customQueries);var n=!0,r="";if(QueryBuilder.hasGeneratedQuery(e)){QueryBuilder.assignParents(e.generatedQuery.root);var s=this.createFileQuery(e.generatedQuery.root);this.extractPrefixes(a,s),r+="\n\t{",r+="\n"+this.removePrefixes(s),r+="\n\t}",n=!1}for(var o in e.customQueries)this.extractPrefixes(a,e.customQueries[o].query),n?n=!1:r+="\n\tUNION",r+="\n\t{\n"+this.removePrefixes(e.customQueries[o].query)+"\n\t}";for(var l in r=t.replace(i,r),a)r="PREFIX "+l+" "+a[l]+"\n"+r;return r}groupHasOverride(e){for(var t in e.artifacts)e.artifacts[t]}removePrefixes(e){return e.replace(/PREFIX\s+[^\s]+\s+[^\s]+\s+/g,"").replace(/^/gm,"\t\t")}mergeSettings(e,t){var i={};for(var a in e){null==i[(n=e[a]).facet]&&(i[n.facet]={}),i[n.facet][n.value]=n.checked}for(var o in t){var n;null==i[(n=t[o]).facet]&&(i[n.facet]={}),i[n.facet][n.value]=n.checked}return i}createQuery(e,t,i,a){if(this.result="",this.cvCounter=0,this.createNodeSubquery(e,a),""==this.result)return null;var o=new RegExp(i,"g");return t.replace(o,this.result)}createFileQuery(e){return this.cvCounter=0,this.result="",this.appendLine("PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>",0),this.appendLine("PREFIX dct:    <http://purl.org/dc/terms/>",0),this.appendLine("PREFIX dcat:   <http://www.w3.org/ns/dcat#>",0),this.appendLine("PREFIX db:     <https://databus.dbpedia.org/>",0),this.appendLine("PREFIX rdf:    <http://www.w3.org/1999/02/22-rdf-syntax-ns#>",0),this.appendLine("PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>",0),this.appendLine("SELECT DISTINCT ?file WHERE {",0),this.appendLine("GRAPH ?g {",1),this.appendLine("?dataset dcat:distribution ?distribution .",2),this.appendLine("?distribution dataid:file ?file .",2),this.createNodeSubquery(e,2),this.appendLine("}",1),this.appendLine("}",0),this.result}createFullQuery(e){return this.cvCounter=0,this.result="",this.appendLine("PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>",0),this.appendLine("PREFIX dct:    <http://purl.org/dc/terms/>",0),this.appendLine("PREFIX dcat:   <http://www.w3.org/ns/dcat#>",0),this.appendLine("PREFIX db:     <https://databus.dbpedia.org/>",0),this.appendLine("PREFIX rdf:    <http://www.w3.org/1999/02/22-rdf-syntax-ns#>",0),this.appendLine("PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>",0),this.appendLine("SELECT DISTINCT ?file ?artifact ?version (GROUP_CONCAT(DISTINCT ?var; SEPARATOR=', ') AS ?variant) ?format ?compression ?size ?preview WHERE {",0),this.appendLine("GRAPH ?g {",1),this.appendLine("?dataset dcat:distribution ?distribution .",2),this.appendLine("?dataset dataid:artifact ?artifact .",2),this.appendLine("?distribution dataid:file ?file .",2),this.appendLine("?distribution dct:hasVersion ?version .",2),this.appendLine("?distribution dataid:formatExtension ?format .",2),this.appendLine("OPTIONAL { ?distribution ?p  ?var. ?p rdfs:subPropertyOf dataid:contentVariant . }",2),this.appendLine("?distribution dataid:compression ?compression .",2),this.appendLine("?distribution dcat:byteSize ?size .",2),this.appendLine("OPTIONAL { ?distribution dataid:preview ?preview . }",2),this.createNodeSubquery(e,2),this.appendLine("}",1),this.appendLine("} GROUP BY ?artifact ?file ?version ?format ?size ?compression ?preview",0),this.result}createNodeSubquery(e,t){for(var i in null!=e.property&&this.appendLine(`?dataset ${e.property} <${e.uri}> .`,t),this.createNodeFacetsSubquery(e,t),e.childNodes)i>0&&this.appendLine("UNION",t),this.appendLine("{",t),this.createNodeSubquery(e.childNodes[i],t+1),this.appendLine("}",t);return this.result}createNodeFacetsSubquery(e,t){var i=this.findAllNodeFacets(e);for(var a in i){var o=i[a];this.hasFacetOverride(e,o)||this.createFacetSubquery(e,o,t)}}hasFacetOverride(e,t){if(0==e.childNodes.length)return!1;if("http://purl.org/dc/terms/hasVersion"==t)for(var i in e.facetSettings[t])if("$latest"==e.facetSettings[t][i].value)return!0;for(var i in e.childNodes){var a=e.childNodes[i];if(null!=a.facetSettings[t])return!0;if(this.hasFacetOverride(a,t))return!0}return!1}createFacetSubquery(e,t,i){var a=!0,o=this.createEnrichedSettings(e,t);if(1==(o=o.filter((function(e){return e.checked}))).length){if(!(r=o[0]).checked)return;"$latest"==r.value&&"http://purl.org/dc/terms/hasVersion"==t?(this.appendLine("{",i),this.appendLine("?distribution dct:hasVersion ?version {",i+1),this.appendLine("SELECT (?v as ?version) { ",i+2),this.appendLine(`?dataset ${e.property} <${e.uri}> . `,i+3),this.appendLine("?dataset dct:hasVersion ?v . ",i+3),this.appendLine("} ORDER BY DESC (?version) LIMIT 1 ",i+2),this.appendLine("}",i+1),this.appendLine("}",i)):this.appendLine(`{ ?distribution <${t}> '${r.value}'${this.stringSuffix} . }`,i)}else if(o.length>1)if("http://purl.org/dc/terms/hasVersion"==t)for(var n in o){(r=o[n]).checked&&(a||this.appendLine("UNION",i),"$latest"==r.value&&"http://purl.org/dc/terms/hasVersion"==t?(this.appendLine("{",i),this.appendLine("?distribution dct:hasVersion ?version {",i+1),this.appendLine("SELECT (?v as ?version) { ",i+2),this.appendLine(`?dataset ${e.property} <${e.uri}> . `,i+3),this.appendLine("?dataset dct:hasVersion ?v . ",i+3),this.appendLine("} ORDER BY DESC (?version) LIMIT 1 ",i+2),this.appendLine("}",i+1),this.appendLine("}",i)):this.appendLine(`{ ?distribution <${t}> '${r.value}'${this.stringSuffix} . }`,i),a=!1)}else{for(var n in this.appendLine("{",i),this.appendLine(`?distribution <${t}> ?c${this.cvCounter} .`,i+1),this.appendLine(`VALUES ?c${this.cvCounter} {`,i+1),o){var r;(r=o[n]).checked&&this.appendLine(`'${r.value}'${this.stringSuffix}`,i+2)}this.appendLine("}",i+1),this.appendLine("}",i),this.cvCounter++}}findAllNodeFacets(e){var t=[];for(var i in e.facetSettings)t.push(i);for(var a=e.parent;null!=a;){for(var i in a.facetSettings)this.hasFacetOverride(a,i)&&(t.includes(i)||t.push(i));a=a.parent}return t}createEnrichedSettings(e,t){var i=[];for(var a in e.facetSettings[t])i.push(e.facetSettings[t][a]);for(var o=e.parent;null!=o;){for(var a in o.facetSettings[t]){var n=o.facetSettings[t][a],r=!1;for(var s in i)if(i[s].value==n.value){r=!0;break}r||i.push(n)}o=o.parent}return i}appendLine(e,t){for(var i=0;i<t;i++)this.result+="\t";this.result+=e,this.result+="\n"}what(){if(this.groupHasOverride(group))for(var e in group.artifacts){var t=group.artifacts[e];isFirstSubquery?isFirstSubquery=!1:query+=FACET_SUBQUERY_UNION;var i=this.mergeSettings(group.settings,t.settings),a=this.createArtifactQuery(t.uri,i);this.extractPrefixes(prefixes,a),query+="\n\t{\n"+this.removePrefixes(a)+"\n\t}"}else{var o=this.createGroupQuery(group.uri,group.settings);this.extractPrefixes(prefixes,o),query+="\n\t{\n"+this.removePrefixes(o)+"\n\t}"}}createArtifactQuery(e,t){var i=this.artifactBaseQuery.replace(this.artifactUriPlaceholder,e),a="";for(var o in t){var n=t[o],r=[];for(var s in n)n[s]&&(s==FACET_LASTEST_VERSION_SUBQUERY_KEY?r.push(this.latestVersionSubquery.replace(this.artifactUriPlaceholder,e)):r.push(this.defaultSubquery.replace(FACET_DEFAULT_SUBQUERY_PLACEHOLDER_FACET,o).replace(FACET_DEFAULT_SUBQUERY_PLACEHOLDER_VALUE,s)));var l="";for(var c in r)c>0&&(l+=FACET_SUBQUERY_UNION),l+=r[c];a+=l}return i.replace(this.optionsPlaceholder,a)}}"object"==typeof module&&module&&module.exports&&(module.exports=QueryBuilder);class QueryNode{constructor(e,t){this.uri=e,this.property=t,this.childNodes=[],this.facetSettings={}}setFacet(e,t,i){var a=this.facetSettings[e];if(null==a&&(this.facetSettings[e]=[],a=this.facetSettings[e]),this.isOverride(e,t,i)){for(var o in a)if(a[o].value==t)return void(a[o].checked=i);a.push({value:t,checked:i})}else{for(var o=0;o<a.length;o++)a[o].value==t&&a.splice(o,1);0==a.length&&delete this.facetSettings[e]}}isOverride(e,t,i){if(null==i){var a=QueryNode.findFacetSetting(this,e,t);i=null!=a&&a.checked}var o=QueryNode.findInheritedSetting(this.parent,e,t);return null==o?i:o.checked!=i}addChild(e){this.childNodes.push(e),e.parent=this}static removeChildByUri(e,t){for(var i=0;i<e.childNodes.length;i++){if(e.childNodes[i].uri==t)return void e.childNodes.splice(i,1);QueryNode.removeChildByUri(e.childNodes[i],t)}}static findChildByUri(e,t){for(let i=0;i<e.childNodes.length;i++){if(e.childNodes[i].uri===t)return e.childNodes[i]=QueryNode.createFrom(e.childNodes[i]),e.childNodes[i];let a=QueryNode.findChildByUri(e.childNodes[i],t);if(null!=a)return a}return null}hasFacetSetting(e,t){for(var i in this.facetSettings[e]){if(this.facetSettings[e][i].value==t)return!0}return!1}createFullFacetSettings(){var e={};for(var t in this.facetSettings)e[t]=JSON.parse(JSON.stringify(this.facetSettings[t]));for(var i=this.parent;null!=i;){for(var t in i.facetSettings)for(var a in null==e[t]&&(e[t]=[]),i.facetSettings[t]){var o=i.facetSettings[t][a];this.hasFacetSetting(t,o.value)||e[t].push(JSON.parse(JSON.stringify(o)))}i=i.parent}return e}static serialize(e){QueryNode.clearParents(e);var t=JSON.stringify(e);return QueryNode.assignParents(e),t}static addChild(e,t){e.childNodes.push(t),t.parent=e}static mergeAddChild(e,t){var i=QueryNode.findChildByUri(e,t.uri);if(null==i)return QueryNode.addChild(e,t),!0;if(0==t.childNodes.length)return!1;for(var a in t.childNodes)QueryNode.mergeAddChild(i,t.childNodes[a])}static clearParents(e){e.parent=null;for(var t=0;t<e.childNodes.length;t++)QueryNode.clearParents(e.childNodes[t])}static assignParents(e){for(var t=0;t<e.childNodes.length;t++)e.childNodes[t].parent=e,QueryNode.assignParents(e.childNodes[t])}static expandAll(e){e.expanded=!0;for(var t=0;t<e.childNodes.length;t++)QueryNode.expandAll(e.childNodes[t])}static createFrom(e){var t=new QueryNode(e.uri,e.property);return t.childNodes=e.childNodes,t.facetSettings=e.facetSettings,t.parent=e.parent,t.files=e.files,t}static createSubTree(e){var t=QueryNode.createFrom(e);return t.facetSettings=t.createFullFacetSettings(),t.parent=null,t}static findFacetSetting(e,t,i){if(null!=e&&null!=e.facetSettings){var a=e.facetSettings[t];if(null!=a)for(var o in a){var n=a[o];if(n.value==i)return n}}}static findInheritedSetting(e,t,i){if(null!=e){var a=QueryNode.findFacetSetting(e,t,i);return null==a?QueryNode.findInheritedSetting(e.parent,t,i):a}}}function ArtifactCardController(){this.$onInit=function(){}}function AutofillDropdownController(e){var t=this;t.$onInit=function(){t.displayValues=[]},t.showAll=function(){t.showDrop=!0,t.displayValues=t.values},t.handleKey=function(e){9!==e.which&&13!==e.which||(t.showDrop=!1,t.displayValues.length>0&&t.input!=t.displayValues[0]&&(e.preventDefault(),t.input=t.displayValues[0],t.change()))},t.hideDropDelayed=function(){e((function(){t.showDrop=!1}),120)},t.autoComplete=function(){if(t.showDrop=!0,""!=t.input&&null!=t.input){for(var e of(t.displayValues=[],t.values))e.includes(t.input)&&e!=t.input&&t.displayValues.push(e);0==t.displayValues.length&&(t.showDrop=!1)}else t.displayValues=t.values},t.change=function(){t.autoComplete(),e((function(){t.onChange()}),50)}}"object"==typeof module&&module&&module.exports&&(module.exports=QueryNode);class ArtifactFacetSettings{constructor(e,t){this.settings=e,this.parentSettings=t}changeSetting(e,t,i){findParentSettingState(e,t)!=i?createOrAddSetting(e,t,i):removeSetting(e,t)}findParentSettingState(e,t){if(null==this.parentSettings)return!1;for(var i in this.parentSettings){var a=this.parentSettings[i];if(a.field==e&&a.value==t)return a.checked}return!1}createOrAddSetting(e,t,i){for(var a in this.settings){var o=this.settings[a];if(o.field==e&&o.value==t)return void(o.checked=i)}this.settings.push({field:e,value:t,checked:i})}removeSetting(e,t){for(var i in this.settings){var a=this.settings[i];if(a.field==e&&a.value==t)return void this.settings.splice[i]}}}class ArtifactFacetViewController{constructor(e){for(var t in this.facetData=e,this.facets={},e){var i=e[t];this.createFilterCategory(t,i.label,i.values)}for(var a in this.maxEntries=3,this.autofill={},this.autofill.inputs={},this.autofill.data={},this.autofill.selected={},this.queryResult={},this.lastRequestRevision=0,this.isLoading=!1,this.tableLimit=20,this.activeTab=0,this.showMore=!1,this.sortReverse=!0,this.sortProperty="version.value",this.facetSettings.settings){var o=this.facetSettings.settings[a];this.addFilter(o.field,o.value,o.checked)}}useSettings(e){for(var t in this.facetSettings=e,this.facetSettings.parentSettings){var i=this.facetSettings.parentSettings[t];(a=this.getOrCreateFacet(settting.field,i.value)).checked=i.checked,a.isOverride=!1}for(var t in this.facetSettings.settings){var a;i=this.facetSettings.settings[t];(a=this.getOrCreateFacet(settting.field,i.value)).checked=i.checked,a.isOverride=!1}}getOrCreateFacet(e,t){null==this.facets[e].values[t]&&(this.facets[e].values[t]={label:t,value:this.toRDFLiteral(t)+" ."})}sortBy(e){this.sortReverse=this.sortProperty===e&&!this.sortReverse,this.sortProperty=e}clearAutofill(e){for(var t in this.autofill.selected)this.autofill.selected[t].length=0;e()}toRDFLiteral(e){return"'"+e+"'^^<http://www.w3.org/2001/XMLSchema#string>"}changeFacet(e,t,i){this.facetSettings.changeSetting(e,t,i),this.facets[e].items[t].checked=i,this.facets[e].items[t].isOverride=this.facetSettings.isOverride(e,t)}createFilterCategory(e,t,i){var a=Math.min(this.maxEntries,i.length);this.facets[e]={},this.facets[e].label=t,this.facets[e].key=e,this.facets[e].items=[],this.autofill.inputs[e]="",this.autofill.data[e]=i,this.autofill.selected[e]=[];for(var o=0;o<a;o++)null!=i[o]&&(this.facets[e].items[i[o]]={label:i[o],value:this.toRDFLiteral(i[o])+" .",checked:!1})}canAddFilters(e){return this.autofill.data[e].length>this.maxEntries}getActiveFilters(e){var t=[];for(var i in this.facets[e].items){var a=this.facets[e].items[i];a.checked&&t.push(a)}return t}hasActiveFilters(e){for(var t in this.facets[e].items){if(this.facets[e].items[t].checked)return!0}return!1}addFilter(e,t,i){for(var a=0;a<this.facets[e].items.length;a++)if(this.facets[e].items[a].label==t)return void(this.facets[e].items[a].checked=i);this.facets[e].items.push({label:t,value:this.toRDFLiteral(t)+" .",checked:i})}applyFilters(e){for(var t in e.clear(),this.facets)for(var i in this.facets[t].items){var a=this.facets[t].items[i];a.checked&&e[t].values.push(a.value)}e.updateQuery()}complete(e){for(var t in this.autofill.selected[e].length=0,this.autofill.data[e]){var i=this.autofill.data[e][t];i.toLowerCase().indexOf(this.autofill.inputs[e].toLowerCase())>=0&&this.autofill.selected[e].push(i)}}querySparql(e,t){this.lastRequestRevision++,this.isLoading=!0,this.totalSize=0,this.numFiles=0;var i=this,a="https://databus.dbpedia.org/repo/sparql?query="+encodeURIComponent(e),o=this.lastRequestRevision;$.ajax({url:a,data:{format:"json"},error:function(){alert("error")},dataType:"jsonp",success:function(e){if(o==i.lastRequestRevision){for(var a in i.queryResult.bindings=e.results.bindings,i.queryResult.uriList="",i.queryResult.bindings){var n=i.queryResult.bindings[a];n.size.numericalValue=parseInt(n.size.value),i.queryResult.uriList+=n.file.value+"\n",i.totalSize+=n.size.numericalValue,i.numFiles++}i.isLoading=!1,t()}},type:"GET"})}}function ArtifactFacetsController(e){var t=this;t.$http=e,t.activeTab=0,t.displayBaseQuery="PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\n\n# Get all files\nSELECT DISTINCT ?file WHERE {\n \t?dataset dataid:artifact <%ARTIFACT_URI%> .\n\t?dataset dcat:distribution ?distribution .%OPTIONS%\n\t?distribution dcat:downloadURL ?file .\n}",t.fullBaseQuery="PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\n\n# Get all files\nSELECT DISTINCT ?file ?version ?variant ?format ?compression ?size ?preview WHERE {\n \t?dataset dataid:artifact <%ARTIFACT_URI%> .\n\t?dataset dcat:distribution ?distribution .\t?distribution dct:hasVersion ?version .\t?distribution dataid:formatExtension ?format .\tOPTIONAL { ?distribution dataid:contentVariant ?variant . }\t?distribution dataid:compression ?compression .\t?distribution dcat:byteSize ?size .\t?distribution dataid:preview ?preview .%OPTIONS%\n\t?distribution dcat:downloadURL ?file .\n}",t.$onInit=function(){t.displayBaseQuery=t.displayBaseQuery.replace("%ARTIFACT_URI%",t.data.uri),t.fullBaseQuery=t.fullBaseQuery.replace("%ARTIFACT_URI%",t.data.uri),t.isLoading=!0,t.$http.get("/system/api/facets",{params:{uri:t.data.uri}}).then((function(e){t.isLoading=!1,null==t.data.settings&&(t.data.settings=[],t.data.settings.push({field:"http://www.w3.org/ns/dcat#version",value:"Latest Version",checked:!0})),e.data["http://www.w3.org/ns/dcat#version"].values.push({label:"Latest Version",value:ArtifactFacetSettings.FACET_ARTIFACT_LATEST_VERSION}),t.facetsCtrl=new ArtifactFacetViewController(e.data,new ArtifactFacetSettings(t.data.settings)),t.displayQueryBuilder=new QueryBuilder(t.displayBaseQuery,"%OPTIONS%",t.data.uri),t.queryBuilder=new QueryBuilder(t.fullBaseQuery,"%OPTIONS%",t.data.uri),t.queryBuilder.onQueryUpdated=function(e){t.querySparql(e)}}))},t.formatUploadSize=function(e){return Math.round(100*e)/100},t.hideAutofill=function(){t.fileSelector.clearAutofill((function(){t.$apply()}))}}function CollectionDataTableController(e,t,i,a){var o=this;o.$http=e,o.$onInit=function(){o.isLoading=!0,DatabusCollectionUtils.getCollectionFiles(o.$http,o.collection).then((function(e){o.files=e,o.isLoading=!1,t.$apply()}),(function(e){o.statistics=null,o.isLoading=!1})),null!=o.files&&(o.groupedFiles=o.groupBy(o.files,"dataset"))},o.getRowspan=function(e){var t=2*e.downloads.length;return e.downloads[e.downloads.length-1].expanded||t--,t},o.groupBy=function(e,t){var i={};for(var a in e){var o=e[a],n=o[t];null==i[n]&&(i[n]={},i[n].value=n,i[n].label=o.label,i[n].uri=o.versionUri,i[n].version=o.version,i[n].downloads=[],i[n].licenses=[]),i[n].downloads.push(o)}return i},o.calculateRowSpan=function(e){var t=0;for(var i in e.downloads)t+=e.downloads[i].expanded?2:1;return t},o.createRelativeUri=function(e){return new URL(e).pathname},o.$doCheck=function(){null!=o.files&&o.previousFileCount!=o.files.length&&(o.previousFileCount=o.files.length,o.groupedFiles=o.groupBy(o.files,"dataset"))},o.formatUploadSize=function(e){return e<1024?e+" B":e<1048576?Math.round(e/1024)+" KB":e<1073741824?Math.round(10*e/1048576)/10+" MB":Math.round(100*e/1073741824)/100+" GB"}}function CollectionEditorWidgetController(e,t){var i=this;i.$scope=t,i.collectionManager=e,i.$onInit=function(){},i.goToEditor=function(){window.location.href="/system/collection-editor"},i.addSelectionToCollection=function(){var e=i.selection;QueryNode.mergeAddChild(i.collection.content.generatedQuery.root,e),i.collectionManager.activeCollection.hasLocalChanges=i.collectionManager.hasLocalChanges(i.collectionManager.activeCollection),i.collectionManager.saveLocally()}}function CollectionEditorController(e,t,i){var a=this;a.activeTab=0,a.viewMode=-1,a.$http=e,a.$onInit=function(){a.viewMode=-1,null!=a.collection&&a.updateViewModel()},a.$doCheck=function(){null!=a.collection?a.previousCollectionId!=a.collection.uuid&&(a.previousCollectionId=a.collection.uuid,a.activeNode=null,a.viewMode=-1,a.updateViewModel()):a.previousCollectionId=null},a.updateViewModel=function(){for(var e in a.collectionWrapper=new DatabusCollectionWrapper(a.collection),a.collection.files=a.groupBy(a.collection.files,"dataset"),a.rootNode={label:a.collection.label,expanded:!0},a.generatedNode={label:"Generated Queries",expanded:a.collection.content.groups.length>0},a.customNode={label:"Custom Queries",expanded:a.collection.content.customQueries.length>0},a.collection.content.groups)a.collection.content.groups[e].expanded=!0},a.groupBy=function(e,t){var i={};for(var a in e){var o=e[a],n=o[t];null==i[n]&&(i[n]={},i[n].value=n,i[n].label=o.label,i[n].version=o.version,i[n].downloads=[],i[n].licenses=[]),i[n].downloads.push(o)}return i},a.sortBy=function(e){a.sortProperty==e&&(a.sortReverse=!a.sortReverse),a.sortProperty=e},a.formatUploadSize=function(e){return Math.round(100*e)/100},a.toHTML=function(e){return i.trustAsHtml(e)},a.showFiles=function(){a.activeTab=0,a.isStatisticsLoading=!1},a.showHierarchy=function(){a.activeTab=1,a.isStatisticsLoading=!1},a.showStatistics=function(){a.activeTab=2,a.isStatisticsLoading=!0,a.loadStatisticsError=null,a.$http.get("/system/api/collection-statistics",{params:{uri:a.collection.uri}}).then((function(e){a.isStatisticsLoading=!1,a.statistics=e.data,null!=a.statistics&&""!=a.statistics?a.statistics.licenses=a.statistics.licenses.split(","):a.loadStatisticsError="Failed to load collection statistics. Make sure the collection is published and try again."}))},a.onComponentAdded=function(){a.generatedNode.expanded=!0},a.customExpanded=function(){return a.customNode.expanded&&a.collection.content.customQueries.length>0},a.generatedExpanded=function(){return a.generatedNode.expanded&&a.collection.content.groups.length>0},a.publishCollection=function(){a.onPublish()},a.delete=function(){a.onDelete()},a.goToResource=function(e){window.location=e.uri},a.showCollectionSearch=function(){a.open=!1,a.viewMode=0,a.activeNode=a.rootNode,t.hash("search")},a.showGroupNode=function(e){a.open=!0,a.viewMode=3,a.activeNode=e},a.showArtifactNode=function(e,t){a.open=!0,a.viewMode=1,a.activeNode=e,a.parentNode=t},a.addCustomNode=function(){a.collectionWrapper.addCustomQueryNode("Custom Query","SELECT * WHERE { ?s ?p ?o. }"),a.customNode.expanded=!0},a.removeArtifactNode=function(e,t){},a.showCustomQueryNode=function(e){a.open=!0,a.viewMode=2,a.activeNode=e}}function CollectionHierarchyControllerTwo(e,t,i,a){var o=this;o.viewMode=-1,o.$http=e,o.$scope=a,o.$onInit=function(){o.viewMode=-1,o.queryBuilder=new QueryBuilder,o.collection},o.isLastChild=function(e,t){return null!=e.childNodes&&0!=e.childNodes.length&&e.childNodes[e.childNodes.length-1].uri==t.uri},o.toggleExpand=function(e){e.expanded=!e.expanded,o.onChange()},o.mergeFacets=function(e,t){if(null!=e.facets){for(var i in t)if(null!=e.facets[i])for(var a of t[i].values)e.facets[i].values.includes(a)||e.facets[i].values.push(a);else e.facets[i]=JSON.parse(JSON.stringify(t[i]));e.facetLabels=null}else e.facets=JSON.parse(JSON.stringify(t))},o.getAllFilters=function(e,t){var i=Object.keys(e.facetSettings).concat(Object.keys(t.facetSettings));return DatabusUtils.uniqueList(i)},o.$doCheck=function(){null!=o.collection?o.previousCollectionId!=o.collection.uuid&&(o.previousCollectionId=o.collection.uuid,o.activeNode=null,o.viewMode=-1,o.updateViewModel()):o.previousCollectionId=null},o.updateViewModel=function(){for(var e in o.collectionWrapper=new DatabusCollectionWrapper(o.collection),o.root=o.collection.content.generatedQuery.root,o.view={},o.view.groups={},o.view.artifacts={},o.root.childNodes){var t=o.root.childNodes[e];for(var i in t.expanded=!0,o.view.groups[t.uri]={},o.$http.get("/system/pages/artifacts-by-group",{params:{uri:t.uri}}).then((function(e){o.view.groups[t.uri].artifacts=e.data})),o.query(t),t.childNodes){var a=t.childNodes[i];o.view.artifacts[a.uri]={},o.$http.get("/system/pages/facets",{params:{uri:a.uri,type:"artifact"}}).then((function(e){e.data["http://purl.org/dc/terms/hasVersion"].values.unshift("$latest");var t=e.config.params.uri,i=DatabusUtils.navigateUp(t);o.view.artifacts[t].facets=e.data,o.mergeFacets(o.view.groups[i],e.data)}))}}},o.onArtifactDropdownChanged=function(e){o.onChange(),o.query(e)},o.selectAddFilterValue=function(e,t){e.addFilterValueInput=t,e.showValueDrop=!1,o.onAddFilterValueInputChanged(e)},o.selectAddFilterFacet=function(e,t){e.addFilterFacetInput=t,e.showFacetDrop=!1,o.onAddFilterFacetInputChanged(e)},o.onAddFilterValueInputChanged=function(e){for(var t of e.facets[e.addFilterFacet].values)if(e.addFilterValueInput==t)return void(e.addFilterValue=t);e.addFilterValue=null},o.onAddFilterFacetInputChanged=function(e){for(var t in e.facets)if(e.addFilterFacetInput==e.facets[t].label)return void(e.addFilterFacet!=t&&(e.addFilterFacet=t,e.addFilterValue=[]));e.addFilterFacet=null,e.addFilterValue=[]},o.includesValue=function(e,t){if(null==e)return!1;for(var i of e)if(i.value==t)return!0;return!1},o.addFilter=function(e,t,i,a){if(null!=i&&0!=i.length){for(var n of(null==e.facetSettings[t]&&(e.facetSettings[t]=[]),i))o.includesValue(e.facetSettings[t],n.value)||e.facetSettings[t].push(n);o.onChange(),o.query(e)}},o.query=function(e){if(null!=e.childNodes&&e.childNodes.length>0)for(var t of(e.files=null,e.childNodes))o.query(t);else{var i=QueryNode.createSubTree(e),a=o.queryBuilder.createQuery(i,DATABUS_QUERIES.nodeFileList,"%COLLECTION_QUERY%",2);this.querySparql(a).then((function(t){e.files=t,o.$scope.$apply()}))}},o.removeFilter=function(e,t){null!=e.facetSettings[t]&&(delete e.facetSettings[t],o.onChange(),o.query(e))},o.onActiveFilterChanged=function(e){o.onChange(),o.query(e)},o.getFacetLabels=function(e){if(null!=e.facetLabels)return e.facetLabels;var t=[];for(var i in e.facets)t.push(e.facets[i].label);return e.facetLabels=t,t},o.sortBy=function(e){o.sortProperty==e&&(o.sortReverse=!o.sortReverse),o.sortProperty=e},o.formatFileSize=function(e){return DatabusUtils.formatFileSize(e)},o.toHTML=function(e){return i.trustAsHtml(e)},o.onComponentAdded=function(){},o.customExpanded=function(){return o.customNode.expanded&&o.collection.content.customQueries.length>0},o.generatedExpanded=function(){return o.generatedNode.expanded&&o.collection.content.groups.length>0},o.publishCollection=function(){o.onPublish()},o.delete=function(){o.onDelete()},o.goToResource=function(e){window.location=e.uri},o.formatGroupPrefix=function(e){return DatabusCollectionUtils.uriToName(DatabusCollectionUtils.navigateUp(e))},o.formatArtifactPrefix=function(e){var t=DatabusCollectionUtils.navigateUp(e),i=DatabusCollectionUtils.uriToName(t);return DatabusCollectionUtils.uriToName(DatabusCollectionUtils.navigateUp(t))+"/"+i},o.uriToName=function(e){return DatabusCollectionUtils.uriToName(e)},o.objSize=function(e){return DatabusUtils.objSize(e)},o.showCollectionSearch=function(){o.open=!1,o.viewMode=0,o.activeNode=o.rootNode,t.hash("search")},o.showGroupNode=function(e){o.open=!0,o.viewMode=3,o.activeNode=QueryNode.createFrom(e),this.updateQuery()},o.showArtifactNode=function(e,t){o.open=!0,o.viewMode=1,o.activeNode=QueryNode.createFrom(e),this.updateQuery()},o.querySparql=async function(e){try{var t={method:"POST",url:DATABUS_SPARQL_ENDPOINT_URL,data:"format=json&query="+encodeURIComponent(e),headers:{"Content-type":"application/x-www-form-urlencoded"}},i=(await o.$http(t)).data.results.bindings;for(var a in i)o.reduceBinding(i[a]);return i}catch(e){console.log(e)}},o.reduceBinding=function(e){for(var t in e)e[t]=e[t].value;return e},o.updateQuery=function(){var e=QueryNode.createSubTree(o.activeNode);o.activeFileQuery=o.queryBuilder.createFileQuery(e),o.activeFullQuery=o.queryBuilder.createFullQuery(e)},o.onActiveNodeChanged=function(){this.updateQuery(),o.onChange()},o.addCustomNode=function(){o.collectionWrapper.addCustomQueryNode("Custom Query","PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\n\n# Get all files\nSELECT DISTINCT ?file WHERE {\n  ?dataset dataid:artifact <https://databus.dbpedia.org/dbpedia/publication/strategy> .\n  ?dataset dcat:distribution ?distribution .\n  ?distribution dcat:downloadURL ?file .\n}"),o.customNode.expanded=!0,o.onChange()},o.removeNode=function(e){var t=e.parent;o.collectionWrapper.removeNodeByUri(e.uri),o.query(t),o.onChange()},o.showCustomQueryNode=function(e){o.open=!0,o.viewMode=2,o.activeNode=e},o.list=function(e){return e.map((function(e){return e.value})).join(", ")}}function CollectionHierarchyController(e,t,i){var a=this;a.viewMode=-1,a.$http=e,a.artifactTableConfig={},a.artifactTableConfig.columns=[],a.artifactTableConfig.columns.push({field:"version",label:"Version",width:"25%"}),a.artifactTableConfig.columns.push({field:"variant",label:"Variant",width:"25%"}),a.artifactTableConfig.columns.push({field:"format",label:"Format",width:"10%"}),a.artifactTableConfig.columns.push({field:"compression",label:"Compression",width:"15%"}),a.groupTableConfig={},a.groupTableConfig.columns=[],a.groupTableConfig.columns.push({field:"artifact",label:"Artifact",width:"35%",uriToName:!0}),a.groupTableConfig.columns.push({field:"version",label:"Version",width:"17%"}),a.groupTableConfig.columns.push({field:"variant",label:"Variant",width:"17%"}),a.groupTableConfig.columns.push({field:"format",label:"Format",width:"8%"}),a.$onInit=function(){a.viewMode=-1,a.queryBuilder=new QueryBuilder,null!=a.collection&&a.updateViewModel()},a.$doCheck=function(){null!=a.collection?a.previousCollectionId!=a.collection.uuid&&(a.previousCollectionId=a.collection.uuid,a.activeNode=null,a.viewMode=-1,a.updateViewModel()):a.previousCollectionId=null},a.updateViewModel=function(){for(var e in a.collectionWrapper=new DatabusCollectionWrapper(a.collection),a.rootNode={label:a.collection.label,expanded:!0},a.generatedNode={label:"Add Groups and Artifacts by Search",expanded:a.collection.content.groups.length>0},a.customNode={label:"Custom Queries",expanded:a.collection.content.customQueries.length>0},a.collection.content.generatedQuery.root.childNodes)a.collection.content.generatedQuery.root.childNodes[e].expanded=!0},a.sortBy=function(e){a.sortProperty==e&&(a.sortReverse=!a.sortReverse),a.sortProperty=e},a.formatUploadSize=function(e){return Math.round(100*e)/100},a.toHTML=function(e){return i.trustAsHtml(e)},a.onComponentAdded=function(){a.generatedNode.expanded=!0},a.customExpanded=function(){return a.customNode.expanded&&a.collection.content.customQueries.length>0},a.generatedExpanded=function(){return a.generatedNode.expanded&&a.collection.content.groups.length>0},a.publishCollection=function(){a.onPublish()},a.delete=function(){a.onDelete()},a.goToResource=function(e){window.location=e.uri},a.formatGroupPrefix=function(e){return DatabusCollectionUtils.uriToName(DatabusCollectionUtils.navigateUp(e))},a.formatArtifactPrefix=function(e){var t=DatabusCollectionUtils.navigateUp(e),i=DatabusCollectionUtils.uriToName(t);return DatabusCollectionUtils.uriToName(DatabusCollectionUtils.navigateUp(t))+"/"+i},a.uriToName=function(e){return DatabusCollectionUtils.uriToName(e)},a.showCollectionSearch=function(){a.open=!1,a.viewMode=0,a.activeNode=a.rootNode,t.hash("search")},a.showGroupNode=function(e){a.open=!0,a.viewMode=3,a.activeNode=QueryNode.createFrom(e),this.updateQuery()},a.showArtifactNode=function(e,t){a.open=!0,a.viewMode=1,a.activeNode=QueryNode.createFrom(e),this.updateQuery()},a.updateQuery=function(){var e=QueryNode.createSubTree(a.activeNode);a.activeFileQuery=a.queryBuilder.createFileQuery(e),a.activeFullQuery=a.queryBuilder.createFullQuery(e)},a.onActiveNodeChanged=function(){this.updateQuery(),a.onChange()},a.addCustomNode=function(){a.collectionWrapper.addCustomQueryNode("Custom Query","PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\n\n# Get all files\nSELECT DISTINCT ?file WHERE {\n  ?dataset dataid:artifact <https://databus.dbpedia.org/dbpedia/publication/strategy> .\n  ?dataset dcat:distribution ?distribution .\n  ?distribution dcat:downloadURL ?file .\n}"),a.customNode.expanded=!0,a.onChange()},a.removeNode=function(e){a.collectionWrapper.removeNodeByUri(e.uri),a.onChange()},a.showCustomQueryNode=function(e){a.open=!0,a.viewMode=2,a.activeNode=e}}function CollectionNodeController(){var e=this;e.$onInit=function(){},e.removeNode=function(){e.onRemoveNode()},e.click=function(){e.onClick()}}function CollectionSearchController(e,t,i,a){var o=this;o.results=[],o.collectionManager=e,o.formatResult=function(e){return a.trustAsHtml(e)},o.$onInit=function(){o.searchInput="",o.filters={},o.filters.filterArtifact=!1,o.filters.filterGroup=!1,o.searchCooldown=1e3,o.root=QueryNode.createFrom(o.collection.content.generatedQuery.root),o.collectionWrapper=new DatabusCollectionWrapper(o.collection),o.autoFocus=!0},o.isInCollection=function(e){let t=e.resource[0].value;return null!=QueryNode.findChildByUri(o.root,t)},o.addToCollection=function(e){if(e.inCollection)QueryNode.removeChildByUri(o.root,e.resource[0].value);else{if("Group"==e.typeName[0].value){let t=new QueryNode(e.resource[0].value,"dataid:group");o.root.addChild(t),o.onComponentAdded()}if("Artifact"==e.typeName[0].value){var t=e.resource[0].value;let i=DatabusCollectionUtils.navigateUp(t),a=QueryNode.findChildByUri(o.root,i);null==a&&(a=new QueryNode(i,"dataid:group"),o.root.addChild(a));let n=new QueryNode(t,"dataid:artifact");a.addChild(n),o.onComponentAdded()}}for(let e in o.results)o.results[e].inCollection=o.isInCollection(o.results[e]);o.collectionManager.saveLocally(),console.log(o.root)},i((function(){if(o.searchChanged){var e="?typeName=Artifact Group";(o.filters.filterArtifact||o.filters.filterGroup)&&(e="?typeName=",o.filters.filterArtifact&&(e+="Artifact "),o.filters.filterGroup&&(e+="Group ")),o.lastQuery=o.searchInput,t({method:"GET",url:"/system/search"+e+"&format=JSON_FULL&minRelevance=10&maxResults=50&query="+o.searchInput}).then((function(e){if(o.lastQuery==e.data.query)for(var t in o.results=e.data.docs,o.results)o.results[t].inCollection=o.isInCollection(o.results[t])}),(function(e){})),o.searchChanged=!1}}),o.searchCooldown),o.search=function(){o.searchChanged=!0}}function CollectionStatisticsController(e,t,i,a){var o=this;o.$http=e,o.$onInit=function(){o.isLoading=!0,DatabusCollectionUtils.getCollectionStatistics(o.$http,o.collection).then((function(e){o.statistics=e,o.isLoading=!1,t.$apply()}),(function(e){o.statistics=null,o.isLoading=!1}))},o.markdownToHtml=function(e){var t=window.markdownit();return a.trustAsHtml(t.render(e))},o.formatUploadSize=function(e){return DatabusUtils.formatFileSize(e)}}function CollectionStatusController(e,t,i){var a=this;a.$onInit=function(){a.colors=[],a.colors.push("#b54c4c"),a.colors.push("#aaa"),a.colors.push("#aaa"),a.colors.push("#e8ca5f"),a.colors.push("#3a3"),a.labels=[],a.labels.push("Draft"),a.labels.push("Hidden, Uncommitted Changes"),a.labels.push("Hidden"),a.labels.push("Visible, Uncommitted Changes"),a.labels.push("Visible")},a.$doCheck=function(){a.isDraft?a.status=0:a.isPublished?a.status=a.hasLocalChanges?3:4:a.status=a.hasLocalChanges?1:2}}function DatabusIconController(){var e=this;e.iconMap={},e.iconMap.add="M 11 11 M 2 12 L 11 12 L 11 21 L 12 21 L 12 12 L 21 12 L 21 11 L 12 11 L 12 2 L 11 2 L 11 11 L 2 11 L 2 12",e.iconMap.delete="M9 3h6v-1.75c0-.066-.026-.13-.073-.177-.047-.047-.111-.073-.177-.073h-5.5c-.066 0-.13.026-.177.073-.047.047-.073.111-.073.177v1.75zm11 1h-16v18c0 .552.448 1 1 1h14c.552 0 1-.448 1-1v-18zm-10 3.5c0-.276-.224-.5-.5-.5s-.5.224-.5.5v12c0 .276.224.5.5.5s.5-.224.5-.5v-12zm5 0c0-.276-.224-.5-.5-.5s-.5.224-.5.5v12c0 .276.224.5.5.5s.5-.224.5-.5v-12zm8-4.5v1h-2v18c0 1.105-.895 2-2 2h-14c-1.105 0-2-.895-2-2v-18h-2v-1h7v-2c0-.552.448-1 1-1h6c.552 0 1 .448 1 1v2h7z",e.iconMap.goto="M21.883 12l-7.527 6.235.644.765 9-7.521-9-7.479-.645.764 7.529 6.236h-21.884v1h21.883z",e.iconMap.edit="M8.071 21.586l-7.071 1.414 1.414-7.071 14.929-14.929 5.657 5.657-14.929 14.929zm-.493-.921l-4.243-4.243-1.06 5.303 5.303-1.06zm9.765-18.251l-13.3 13.301 4.242 4.242 13.301-13.3-4.243-4.243z",e.iconMap.goback="M2.117 12l7.527 6.235-.644.765-9-7.521 9-7.479.645.764-7.529 6.236h21.884v1h-21.883z",e.iconMap.right="M4 .755l14.374 11.245-14.374 11.219.619.781 15.381-12-15.391-12-.609.755z",e.iconMap.left="M20 .755l-14.374 11.245 14.374 11.219-.619.781-15.381-12 15.391-12 .609.755z",e.iconMap.help="M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm0 1c6.071 0 11 4.929 11 11s-4.929 11-11 11-11-4.929-11-11 4.929-11 11-11zm.053 17c.466 0 .844-.378.844-.845 0-.466-.378-.844-.844-.844-.466 0-.845.378-.845.844 0 .467.379.845.845.845zm.468-2.822h-.998c-.035-1.162.182-2.054.939-2.943.491-.57 1.607-1.479 1.945-2.058.722-1.229.077-3.177-2.271-3.177-1.439 0-2.615.877-2.928 2.507l-1.018-.102c.28-2.236 1.958-3.405 3.922-3.405 1.964 0 3.615 1.25 3.615 3.22 0 1.806-1.826 2.782-2.638 3.868-.422.563-.555 1.377-.568 2.09z",e.iconMap.max="M24 22h-24v-20h24v20zm-7-1v-15h-16v15h16zm1 0h5v-18h-22v2h17v16zm-6-6h-1v-3.241l-7.241 7.241-.759-.759 7.241-7.241h-3.241v-1h5v5z",e.iconMap.min="M24 22h-24v-20h24v20zm-23-9v8h10v-8h-10zm22 8v-18h-22v9h11v9h11zm-4-9h-5v-5h1v3.241l5.241-5.241.759.759-5.241 5.241h3.241v1z",e.iconMap.error="M24 23h-24l12-22 12 22zm-22.315-1h20.63l-10.315-18.912-10.315 18.912zm10.315-2c.466 0 .845-.378.845-.845 0-.466-.379-.844-.845-.844-.466 0-.845.378-.845.844 0 .467.379.845.845.845zm.5-11v8h-1v-8h1z",e.iconMap.info="M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm0 1c6.071 0 11 4.929 11 11s-4.929 11-11 11-11-4.929-11-11 4.929-11 11-11zm.5 17h-1v-9h1v9zm-.5-12c.466 0 .845.378.845.845 0 .466-.379.844-.845.844-.466 0-.845-.378-.845-.844 0-.467.379-.845.845-.845z",e.iconMap.eye="M12.01 20c-5.065 0-9.586-4.211-12.01-8.424 2.418-4.103 6.943-7.576 12.01-7.576 5.135 0 9.635 3.453 11.999 7.564-2.241 4.43-6.726 8.436-11.999 8.436zm-10.842-8.416c.843 1.331 5.018 7.416 10.842 7.416 6.305 0 10.112-6.103 10.851-7.405-.772-1.198-4.606-6.595-10.851-6.595-6.116 0-10.025 5.355-10.842 6.584zm10.832-4.584c2.76 0 5 2.24 5 5s-2.24 5-5 5-5-2.24-5-5 2.24-5 5-5zm0 1c2.208 0 4 1.792 4 4s-1.792 4-4 4-4-1.792-4-4 1.792-4 4-4z",e.iconMap["add-artifact"]="M 12 0 M 12.016 1.424 L 21.756 12.053 L 12.016 22.563 L 2.204 12.005 L 3.396 10.721 L 2.774 10.058 L 1 12 L 12 24 L 23 12 L 12 0 L 10.153 2.078 L 10.837 2.741 Z M 6 6 L 6 2 L 7 2 L 7 6 L 11 6 L 11 7 L 7 7 L 7 11 L 6 11 L 6 7 L 2 7 L 2 6 L 6 6",e.iconMap["add-button"]="M24 10h-10v-10h-4v10h-10v4h10v10h4v-10h10z",e.iconMap.collections="M 0 10 M 1 12 L 2 12 L 2 23 L 22 23 L 22 12 L 23 12 L 23 24 L 1 24 L 1 12 M 9 14 L 15 14 L 15 15 L 9 15 L 9 14 M 0 10 L 0.016 7.54 L 6 0 L 18 0 L 23.996 7.519 L 24 10 L 0 10 M 1 9 L 23 9 L 23 8 L 17.395 1.032 L 6.581 1.032 L 1 8 Z",e.iconMap.content="M9.484 15.696l-.711-.696-2.552 2.607-1.539-1.452-.698.709 2.25 2.136 3.25-3.304zm0-5l-.711-.696-2.552 2.607-1.539-1.452-.698.709 2.25 2.136 3.25-3.304zm0-5l-.711-.696-2.552 2.607-1.539-1.452-.698.709 2.25 2.136 3.25-3.304zm10.516 11.304h-8v1h8v-1zm0-5h-8v1h8v-1zm0-5h-8v1h8v-1zm4-5h-24v20h24v-20zm-1 19h-22v-18h22v18z",e.iconMap.menu="M24 18v1h-24v-1h24zm0-6v1h-24v-1h24zm0-6v1h-24v-1h24z",e.iconMap.copy="M17 7h6v16h-16v-6h-6v-16h16v6zm5 1h-14v14h14v-14zm-6-1v-5h-14v14h5v-9h9z",e.iconMap.upload="M9 16h-8v6h22v-6h-8v-1h9v8h-24v-8h9v1zm11 2c.552 0 1 .448 1 1s-.448 1-1 1-1-.448-1-1 .448-1 1-1zm-7.5 0h-1v-14.883l-4.735 5.732-.765-.644 6.021-7.205 5.979 7.195-.764.645-4.736-5.724v14.884z",e.iconMap.hide="M8.137 15.147c-.71-.857-1.146-1.947-1.146-3.147 0-2.76 2.241-5 5-5 1.201 0 2.291.435 3.148 1.145l1.897-1.897c-1.441-.738-3.122-1.248-5.035-1.248-6.115 0-10.025 5.355-10.842 6.584.529.834 2.379 3.527 5.113 5.428l1.865-1.865zm6.294-6.294c-.673-.53-1.515-.853-2.44-.853-2.207 0-4 1.792-4 4 0 .923.324 1.765.854 2.439l5.586-5.586zm7.56-6.146l-19.292 19.293-.708-.707 3.548-3.548c-2.298-1.612-4.234-3.885-5.548-6.169 2.418-4.103 6.943-7.576 12.01-7.576 2.065 0 4.021.566 5.782 1.501l3.501-3.501.707.707zm-2.465 3.879l-.734.734c2.236 1.619 3.628 3.604 4.061 4.274-.739 1.303-4.546 7.406-10.852 7.406-1.425 0-2.749-.368-3.951-.938l-.748.748c1.475.742 3.057 1.19 4.699 1.19 5.274 0 9.758-4.006 11.999-8.436-1.087-1.891-2.63-3.637-4.474-4.978zm-3.535 5.414c0-.554-.113-1.082-.317-1.562l.734-.734c.361.69.583 1.464.583 2.296 0 2.759-2.24 5-5 5-.832 0-1.604-.223-2.295-.583l.734-.735c.48.204 1.007.318 1.561.318 2.208 0 4-1.792 4-4z",e.iconMap.download="M6 16h-5v6h22v-6h-5v-1h6v8h-24v-8h6v1zm14 2c.552 0 1 .448 1 1s-.448 1-1 1-1-.448-1-1 .448-1 1-1zm-7.5-17v14.884l4.736-5.724.764.645-5.979 7.195-6.021-7.205.765-.644 4.735 5.732v-14.883h1z",e.iconMap.import="M16.965 2.381c3.593 1.946 6.035 5.749 6.035 10.119 0 6.347-5.153 11.5-11.5 11.5s-11.5-5.153-11.5-11.5c0-4.37 2.442-8.173 6.035-10.119l.608.809c-3.353 1.755-5.643 5.267-5.643 9.31 0 5.795 4.705 10.5 10.5 10.5s10.5-4.705 10.5-10.5c0-4.043-2.29-7.555-5.643-9.31l.608-.809zm-4.965-2.381v14.826l3.747-4.604.753.666-5 6.112-5-6.101.737-.679 3.763 4.608v-14.828h1z",e.$onInit=function(){e.path=e.iconMap[e.shape]}}function DatabusSearchController(e,t,i){var a=this;a.searchResults=[],a.formatResult=function(e){return i.trustAsHtml(e)},a.$onInit=function(){a.input="",a.searchCooldown=1e3,a.hasSearchChanged=!1,a.isSearchReady=!0},a.invokeSearch=function(){a.isSearchReady?(a.search(),a.isSearchReady=!1):a.hasSearchChanged=!0},t((function(){a.hasSearchChanged&&(a.searchscope(),a.hasSearchChanged=!1),a.isSearchReady=!0}),a.searchCooldown),a.search=function(){if(""!=a.input){var t="";null!=a.filters&&a.filters.length>0&&(t="&"+a.filters.join("&")),e({method:"GET",url:"/system/search?query="+a.input+t}).then((function(e){for(var t in a.results=[],e.data.docs){var i=e.data.docs[t],o={label:i.label[0],desc:i.comment[0],uri:i.resource[0],type:i.typeName[0]};a.searchResults.push(o)}}),(function(e){console.log(e)}))}}}function EditLabelController(e){var t=this,i=null;t.$onInit=function(){t.isEdit=!1,i=null},t.edit=function(){t.isEdit=!0},t.$doCheck=function(){i!=t.text&&(t.onChange(),i=t.text)}}function EntityCardController(e){this.$onInit=function(){},this.formatResult=function(t){return e.trustAsHtml(t)}}function ExpandableArrowController(){var e=this;e.$onInit=function(){null==e.isReadonly&&(e.isReadonly=!1)},e.change=function(){e.isReadonly||(e.expanded=!e.expanded,e.onChange())}}databusApplication.component("artifactFacets",{templateUrl:"/templates/artifact-facets.html",controller:["$http",ArtifactFacetsController],bindings:{data:"="}});class FacetSettings{constructor(e,t){this.facets=e,this.parentFacets=t}changeSetting(e,t,i){return this.findParentSettingState(e,t)!=i?this.createOrAddSetting(e,t,i):this.removeSetting(e,t),i}findParentSettingState(e,t){if(null==this.parentFacets)return!1;for(var i in this.parentFacets){var a=this.parentFacets[i];if(a.key==e&&a.value==t)return a.checked}return!1}findOwnSettingState(e,t){for(var i in this.facets){var a=this.facets[i];if(a.key==e&&a.value==t)return a.checked}return!1}isOverride(e,t,i){return this.findParentSettingState(e,t)!=i}createOrAddSetting(e,t,i){for(var a in this.facets){var o=this.facets[a];if(a==e&&o.value==t)return void(o.checked=i)}this.facets[e]={value:t,checked:i}}removeSetting(e,t){for(var i in this.facets){var a=this.facets[i];if(a.key==e&&a.value==t)return void this.facets.splice(i,1)}}}function FacetsViewController(e,t){var i=this;i.$http=e,i.maxEntries=6,i.$onInit=function(){},i.$onChanges=function(){i.isLoading=!0,i.node=QueryNode.createFrom(i.node),i.viewModel={},null==i.facets&&(i.facets=[]);var e="version"==i.resourceType?i.node.uri+"/"+i.node.facetSettings["http://purl.org/dc/terms/hasVersion"][0].value:i.node.uri;i.$http.get("/system/pages/facets",{params:{uri:e,type:i.resourceType}}).then((function(e){if(i.isLoading=!1,"group"==i.resourceType)for(var t in e.data["http://dataid.dbpedia.org/ns/core#artifact"].values){var a=e.data["http://dataid.dbpedia.org/ns/core#artifact"].values[t];e.data["http://dataid.dbpedia.org/ns/core#artifact"].values[t]=DatabusCollectionUtils.uriToName(a)}for(var o in e.data){var n=e.data[o];for(var r in i.viewModel[o]={},i.viewModel[o].key=o,i.viewModel[o].label=n.label,i.viewModel[o].visibleFacetSettings=[],i.viewModel[o].autofill={},i.viewModel[o].autofill.values=n.values,i.viewModel[o].autofill.selectedValues=[],i.viewModel[o].autofill.input="",n.values){var s={value:a=n.values[r],checked:!1,isOverride:!1};if(i.viewModel[o].visibleFacetSettings.push(s),r>=i.maxEntries-1)break}}"version"!=i.resourceType?i.viewModel[FACET_VERSION_KEY].visibleFacetSettings.unshift({value:FACET_LATEST_VERSION_VALUE,checked:!1,isOverride:!1}):delete i.viewModel[FACET_VERSION_KEY];var l=i.node.createFullFacetSettings();for(var o in l){var c=l[o];for(var t in c){s=c[t];null!=(u=i.getOrCreateVisibleFacetSetting(o,s.value))&&(u.checked=s.checked,u.isOverride=i.node.isOverride(o,s.value,s.checked))}}if("group"==i.resourceType)for(var t in i.node.childNodes){var u,d=i.node.childNodes[t],h=DatabusCollectionUtils.uriToName(d.uri);(u=i.getOrCreateVisibleFacetSetting("http://dataid.dbpedia.org/ns/core#artifact",h)).checked=!0,u.isOverride=!0}i.onLoaded()}))},i.getFacetLabel=function(e){return e==FACET_LATEST_VERSION_VALUE?FACET_LATEST_VERSION_LABEL:e},i.changeFacetValueState=function(e,t,a){if("group"==i.resourceType&&"http://dataid.dbpedia.org/ns/core#artifact"==e){var o=i.node.uri+"/"+t;if(a){var n=new QueryNode(o,"dataid:artifact");QueryNode.addChild(i.node,n)}else QueryNode.removeChildByUri(i.node,o);null!=(r=i.getOrCreateVisibleFacetSetting(e,t))&&(r.checked=a,r.isOverride=a)}else{var r;i.node.setFacet(e,t,a),null!=(r=i.getOrCreateVisibleFacetSetting(e,t))&&(r.checked=a,r.isOverride=i.node.isOverride(e,t,a))}i.viewModel[e].autofill.selectedValues.length>0&&i.complete(i.viewModel[e]),i.onChange()},i.getOrCreateVisibleFacetSetting=function(e,t){if(null==i.viewModel[e]){var a=DatabusCollectionUtils.uriToName(e);a=a[0].toUpperCase()+a.slice(1),i.viewModel[e]={},i.viewModel[e].key=e,i.viewModel[e].label=a,i.viewModel[e].visibleFacetSettings=[],i.viewModel[e].autofill={},i.viewModel[e].autofill.values=[],i.viewModel[e].autofill.selectedValues=[],i.viewModel[e].autofill.input=""}for(var o in i.viewModel[e].visibleFacetSettings){var n=i.viewModel[e].visibleFacetSettings[o];if(n.value==t)return n}var r={value:t};return i.viewModel[e].visibleFacetSettings.push(r),r},i.getActiveFilters=function(e){var t=[];for(var a in i.facets[e].items){var o=i.facets[e].items[a];o.checked&&t.push(o)}return t},i.hasActiveFilters=function(e){for(var t in i.facets[e].items){if(i.facets[e].items[t].checked)return!0}return!1},i.complete=function(e){for(var t in e.autofill.selectedValues.length=0,e.autofill.values){var i=e.autofill.values[t];if(i.toLowerCase().indexOf(e.autofill.input.toLowerCase())>=0){var a=!0;for(var o in e.visibleFacetSettings){e.visibleFacetSettings[o].value==i.toLowerCase()&&(a=!1)}a&&e.autofill.selectedValues.push(i)}}},i.clearAutofill=function(){var e=i;for(var t in e.viewModel){e.viewModel[t].autofill.selectedValues.length=0}}}function FileBrowserController(e,t){var i=this;i.$http=e,i.activeTab=0,i.$scope=t,i.$onInit=function(){i.lastRequestRevision=0,i.tableLimit=20,i.sortProperty="version.value",i.sortReverse=!1,i.queryResult={}},i.sortBy=function(e){i.sortProperty==e&&(i.sortReverse=!i.sortReverse),i.sortProperty=e},i.getCellValues=function(e,t){var i=e[t.field].value;return t.uriToName&&(i=DatabusCollectionUtils.uriToName(i)),i},i.formatUploadSize=function(e){return DatabusUtils.formatFileSize(e)},i.createRelativeUri=function(e){return new URL(e).pathname},i.querySparql=async function(e){i.isLoading=!0,i.totalSize=0,i.numFiles=0;try{var a={method:"POST",url:DATABUS_SPARQL_ENDPOINT_URL,data:"format=json&query="+encodeURIComponent(e),headers:{"Content-type":"application/x-www-form-urlencoded"}},o=(await i.$http(a)).data;for(var n in i.isLoading=!1,i.queryResult.bindings=o.results.bindings,i.queryResult.uriList="",i.queryResult.bindings){var r=i.queryResult.bindings[n];r.size.numericalValue=parseInt(r.size.value),i.queryResult.uriList+=r.file.value+"\n",i.totalSize+=r.size.numericalValue,i.numFiles++}i.totalSize=i.formatUploadSize(i.totalSize),t.$root.$$phase||i.$scope.$apply()}catch(e){console.log(e)}},i.$doCheck=function(){i.query!=i.fileQuery&&(i.fileQuery=i.query,i.querySparql(i.fullQuery))}}function MultiselectArtifactDropdownController(e,t){var i=this;i.$sce=t,i.$onInit=function(){i.artifacts=i.node.artifacts},i.handleKey=function(e){9!==e.which&&13!==e.which||(i.showDrop=!1)},i.hasContent=function(){return node.artifacts.length>0},i.hideDropDelayed=function(){e((function(){i.showDrop=!1}),120)},i.isChecked=function(e){for(var t in i.node.childNodes)if(i.node.childNodes[t].uri==e.artifactUri)return!0;return!1},i.toggle=function(e){var t=QueryNode.createFrom(i.node);if(QueryNode.findChildByUri(t,e.artifactUri))QueryNode.removeChildByUri(t,e.artifactUri);else{let i=new QueryNode(e.artifactUri,"dataid:artifact");t.addChild(i)}i.change()},i.change=function(){e((function(){i.onChange()}),50)}}function MultiselectDropdownController(e,t){var i=this;i.$sce=t,i.$onInit=function(){},i.handleKey=function(e){9!==e.which&&13!==e.which||(i.showDrop=!1)},i.getLabel=function(e){return"$latest"==e?"Latest Version":e},i.hasContent=function(){return!!(null!=i.input&&0!=i.input.length||null!=i.parentInput&&0!=i.parentInput.length)},i.mergeSettings=function(e,t){var i={};if(null!=e)for(var a of e)i[a.value]=a.checked;for(var o in t){i[(a=t[o]).value]=a.checked}return i},i.list=function(){var e=i.mergeSettings(i.parentInput,i.input);return i.$sce.trustAsHtml(Object.keys(e).map((function(t,a){return e[t]?i.getLabel(t):`<s>${i.getLabel(t)}</s>`})).join(", "))},i.hideDropDelayed=function(){e((function(){i.showDrop=!1}),120)},i.includesValue=function(e,t){if(null==e)return!1;for(var i of e)if(i.value==t)return!0;return!1},i.isChecked=function(e,t){if(null==e)return!1;for(var i of e)if(i.value==t)return i.checked;return!1},i.veryStupidDelete=function(e,t){let i=-1,a=0;if(null==e)return!1;for(var o of e){if(o.value==t){i=a;break}a++}e.splice(a,1)},i.toggle=function(e){null==i.input&&(i.input=[]);var t=null!=i.parentInput&&i.includesValue(i.parentInput,e);i.includesValue(i.input,e)?i.veryStupidDelete(i.input,e):i.input.push({value:e,checked:!t}),i.change()},i.change=function(){e((function(){i.onChange()}),50)}}function OverrideCheckboxController(){var e=this;e.$onInit=function(){null==e.id&&(e.id=e.label)},e.change=function(){e.readonly||e.onChange()}}function SearchController(e,t,i){var a=this;a.results=[],a.formatResult=function(e){return i.trustAsHtml(e)},a.searchInput="",a.filters={},a.filters.filterArtifact=!1,a.filters.filterGroup=!1,a.filters.filterPublisher=!1,a.filters.filterCollection=!1,a.searchCooldown=300,t((function(){if(a.searchChanged){var t="";(a.filters.filterCollection||a.filters.filterArtifact||a.filters.filterGroup||a.filters.filterPublisher)&&(t="&minRelevance=20&maxResults=50&typeName=",a.filters.filterCollection&&(t+="Collection "),a.filters.filterArtifact&&(t+="Artifact "),a.filters.filterGroup&&(t+="Group "),a.filters.filterPublisher&&(t+="PersonalProfileDocument ")),e({method:"GET",url:"/system/search?query="+a.searchInput+t}).then((function(e){a.results=e.data}),(function(e){})),a.searchChanged=!1}}),a.searchCooldown),a.search=function(){a.searchChanged=!0}}function TableEditorController(){var e=this;e.$onInit=function(){e.selection={},e.edit={},null==e.model.groupMode&&(e.model.groupMode=!0),e.setupColumns(),e.updateViewModel()},e.setupColumns=function(){for(var t in e.columns=[],e.columns.push({title:"File",width:280,isReadonly:!0}),e.columns.push({title:"Format",width:75,isReadonly:!0}),e.columns.push({title:"Compression",width:115,isReadonly:!0}),e.model.contentVariants){var i=e.model.contentVariants[t];e.columns.push({title:i.label,width:120,isReadonly:!1})}e.columns.push({title:"Size",width:115,isReadonly:!0}),e.columns.push({title:"Shasum",width:200,isReadonly:!0}),e.columns.push({title:"Actions",width:140,isReadonly:!0}),e.progressWidth="315px"},e.toggleGroupMode=function(){e.model.groupMode=!e.model.groupMode,e.updateViewModel()},e.onShowInput=function(e){},e.deselect=function(){e.edit.x=void 0,e.edit.y=void 0,e.selection.x=void 0,e.selection.y=void 0,e.selection.width=0,e.selection.height=0},e.selectCell=function(t,i,a){if(e.selection.x==i&&e.selection.y==a)return e.edit.x=i,void(e.edit.y=a);e.edit.x=void 0,e.edit.y=void 0,e.selection.x=i,e.selection.y=a,e.selection.width=1,e.selection.height=1},e.analyzeFile=function(t){e.onAnalyzeFile({file:t})},e.onChangeCv=function(t,i){for(var a=e.model.files.findIndex((e=>e.uri==t.uri)),o=a+1;o<a+t.rowspan;o++)e.model.files[o].contentVariants[i.label]=t.contentVariants[i.label];e.model.isConfigDirty=!0},e.updateViewModel=function(){for(var t in e.model.files)e.model.files[t].rowspan=1;if(e.model.groupMode)for(var i=0,a=1;i+a<e.model.files.length;)if(e.model.files[i].name==e.model.files[i+a].name){for(var o in e.model.files[i].rowspan++,e.model.files[i+a].rowspan=0,e.model.contentVariants){var n=e.model.contentVariants[o];e.model.files[i+a].contentVariants[n.label]=e.model.files[i].contentVariants[n.label]}a++}else i+=a,a=1},e.removeFileFromArtifact=function(t){e.onRemoveFile({file:t})},e.$doCheck=function(){var t=DatabusUtils.objSize(e.model.files);if(e.numFiles!=t&&(e.updateViewModel(),e.numFiles=t),null!=e.columns){var i=6;for(var a in e.model.contentVariants)i++;e.progressPosition=45;for(var o=0;o<i-3;o++)e.progressPosition+=e.columns[o].width;e.progressPosition=e.progressPosition+"px",e.columns.length!=i&&e.setupColumns()}},e.change=function(){}}function TypeTagController(){var e=this;e.typeMap={},e.typeMap.Artifact="is-artifact",e.typeMap.Version="is-version",e.typeMap.Group="is-group",e.typeMap.Service="is-service",e.typeMap.PersonalProfileDocument="is-consumer",e.typeMap.Collection="is-collection",e.typeMap.BlogEntry="is-blog",e.iconMap={},e.iconMap.Artifact="M12,0 L1,12 l11,12 l11,-12 L12,0z",e.iconMap.Version="M 12,0 0.99999997,11.999022 12,23.999999 15.166016,20.546592 A 4.0000001,4.0003251 0 0 1 13,16.99943 a 4.0000001,4.0003251 0 0 1 4,-4.000327 4.0000001,4.0003251 0 0 1 3.378906,1.859527 l 2.621093,-2.859608 z",e.iconMap.Group="M21.698 10.658l2.302 1.342-12.002 7-11.998-7 2.301-1.342 9.697 5.658 9.7-5.658zm-9.7 10.657l-9.697-5.658-2.301 1.343 11.998 7 12.002-7-2.302-1.342-9.7 5.657zm12.002-14.315l-12.002-7-11.998 7 11.998 7 12.002-7z",e.iconMap.Service="M24 13.616v-3.232l-2.869-1.02c-.198-.687-.472-1.342-.811-1.955l1.308-2.751-2.285-2.285-2.751 1.307c-.613-.339-1.269-.613-1.955-.811l-1.021-2.869h-3.232l-1.021 2.869c-.686.198-1.342.471-1.955.811l-2.751-1.308-2.285 2.285 1.308 2.752c-.339.613-.614 1.268-.811 1.955l-2.869 1.02v3.232l2.869 1.02c.197.687.472 1.342.811 1.955l-1.308 2.751 2.285 2.286 2.751-1.308c.613.339 1.269.613 1.955.811l1.021 2.869h3.232l1.021-2.869c.687-.198 1.342-.472 1.955-.811l2.751 1.308 2.285-2.286-1.308-2.751c.339-.613.613-1.268.811-1.955l2.869-1.02zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z",e.iconMap.PersonalProfileDocument="M19 7.001c0 3.865-3.134 7-7 7s-7-3.135-7-7c0-3.867 3.134-7.001 7-7.001s7 3.134 7 7.001zm-1.598 7.18c-1.506 1.137-3.374 1.82-5.402 1.82-2.03 0-3.899-.685-5.407-1.822-4.072 1.793-6.593 7.376-6.593 9.821h24c0-2.423-2.6-8.006-6.598-9.819z",e.iconMap.Collection="M11.499 12.03v11.971l-10.5-5.603v-11.835l10.5 5.467zm11.501 6.368l-10.501 5.602v-11.968l10.501-5.404v11.77zm-16.889-15.186l10.609 5.524-4.719 2.428-10.473-5.453 4.583-2.499zm16.362 2.563l-4.664 2.4-10.641-5.54 4.831-2.635 10.474 5.775z",e.iconMap.BlogEntry="M21 9.662c-2.287.194-5.197 1.038-7 1.794v-1.064c1.933-.721 4.598-1.54 7-1.745v1.015zm0 2.031c-2.287.194-5.197 1.038-7 1.794v-1.064c1.933-.721 4.598-1.54 7-1.745v1.015zm0 2.031c-2.287.194-5.197 1.038-7 1.794v-1.064c1.933-.721 4.598-1.54 7-1.745v1.015zm0 2.031c-2.287.194-5.197 1.038-7 1.794v-1.064c1.933-.721 4.598-1.54 7-1.745v1.015zm0-9.951c-2.402.204-5.068 1.024-7 1.745v1.933c1.804-.756 4.713-1.6 7-1.794v-1.884zm-18 2.843c2.402.205 5.067 1.024 7 1.745v1.064c-1.803-.756-4.713-1.6-7-1.794v-1.015zm0 2.031c2.402.205 5.067 1.024 7 1.745v1.064c-1.803-.756-4.713-1.6-7-1.794v-1.015zm0 2.031c2.402.205 5.067 1.024 7 1.745v1.064c-1.803-.756-4.713-1.6-7-1.794v-1.015zm0 2.032c2.402.205 5.067 1.024 7 1.745v1.064c-1.803-.756-4.713-1.6-7-1.794v-1.015zm0-7.054c2.287.194 5.196 1.038 7 1.794v-1.933c-1.932-.72-4.598-1.54-7-1.744v1.883zm9-2.724c-3.063-1.671-7.776-2.755-12-2.963v17c4.289.206 8.195 1.249 12 3 3.805-1.751 7.711-2.794 12-3v-17c-4.224.208-8.937 1.292-12 2.963zm-10-.791c4.264.496 6.86 1.467 9 2.545v12.702c-2.968-1.184-5.939-1.95-9-2.271v-12.976zm20 12.975c-3.061.321-6.032 1.088-9 2.271v-12.701c2.187-1.103 4.757-2.051 9-2.544v12.974z",e.$onInit=function(){e.class=e.typeMap[e.type],e.icon=e.iconMap[e.type],e.style={},e.style.width=e.width+"px",e.style.height=e.height+"px"}}function UriBreadcrumbsController(){var e=this;e.$onInit=function(){e.entries=[];var t=e.uri,i=`${DATABUS_RESOURCE_BASE_URL}/`,a=t.replace(i,"").split("/"),o="";for(var n in a){var r=a[n];o+=r+"/",e.entries.push({label:r,uri:"/"+o})}}}function YasqeTextController(e,t){var i=this;i.textField=t.find("textarea"),i.$scope=e,i.$onInit=function(){i.yasqe=YASQE.fromTextArea(i.textField[0],{lineNumbers:!0,viewportMargin:1/0,readOnly:i.readOnly,autorefresh:!0}),i.yasqe.on("change",(function(){i.query=i.yasqe.getValue(),i.valid=!i.yasqe.queryValid,e.$root.$$phase||i.$scope.$apply(),i.onChange()})),i.yasqe.setValue(i.query)},i.$doCheck=function(){null!=i.yasqe&&i.yasqe.getValue()!=i.query&&i.yasqe.setValue(i.query),setTimeout((function(){i.yasqe.refresh()}),10)}}var DEFAULT_IMAGE="https://picsum.photos/id/223/320/320";function AccountPageController(e,t,i){if(e.profileData=data.profile,e.auth=data.auth,e.location=i,null!=e.profileData){e.searchInput="",e.searchFilters=["publisherUri="+encodeURIComponent(`https://databus.dbpedia.org/${e.profileData.accountName}`),"minRelevance=0.1"],e.artifactData={},e.artifactData.isLoading=!0,t.get(`/system/pages/account/artifacts?account=${encodeURIComponent(e.profileData.accountName)}`).then((function(t){e.artifactData.groups=t.data,e.artifactData.isLoading=!1;var i=[];for(var a in e.artifactData.groups){var o=e.artifactData.groups[a];for(var n in o.artifacts){var r=o.artifacts[n];i.push(e.artifactData.groups[a].artifacts[n]),(null==o.lastUpdateDate||o.lastUpdateDate<r.date)&&(o.lastUpdateDate=r.date)}}i.sort(((e,t)=>e.date>t.date?-1:1)),e.recentUploads=i.slice(0,3),e.refreshFeaturedContent()}),(function(e){console.log(e)})),e.statsData={},e.statsData.isLoading=!0,t.get(`/system/pages/account/stats?account=${encodeURIComponent(e.profileData.accountName)}`).then((function(t){e.statsData.stats=t.data,e.statsData.isLoading=!1}),(function(e){console.log(e)})),e.activityData={},e.activityData.isLoading=!0,t.get(`/system/pages/account/activity?account=${encodeURIComponent(e.profileData.accountName)}`).then((function(t){e.activityData.entries=t.data,e.activityData.isLoading=!1}),(function(e){console.log(e)})),e.collectionsData={},e.collectionsData.isLoading=!0,t.get(`/system/pages/account/collections?account=${encodeURIComponent(e.profileData.accountName)}`).then((function(t){e.collectionsData.collections=t.data,e.collectionsData.isLoading=!1,e.refreshFeaturedContent()}),(function(e){console.log(e)})),e.getImageUrl=function(){return null==e.profileData.imageUrl?DEFAULT_IMAGE:e.profileData.imageUrl},e.uriToName=function(e){return DatabusUtils.uriToName(e)},e.formatDateFromNow=function(e){return moment(e).fromNow()},e.formatCollectionDateFromNow=function(e){var t=new Number(e),i=new Date(t);return moment(i).fromNow()},e.formatDate=function(e){return moment(e).format("MMM Do YYYY")+" ("+moment(e).fromNow()+")"},e.profileData.isOwn=e.auth.authenticated&&e.auth.info.accountName==e.profileData.accountName,e.tabViewModel={},e.tabViewModel.activeTab=0,e.tabViewModel.tabs=[],e.tabViewModel.tabs.length=4,e.goToTab=function(e){i.hash(e)},e.$watch("location.hash()",(function(t,i){"settings"==t&&(e.tabViewModel.activeTab=4),"collections"==t&&(e.tabViewModel.activeTab=2),"data"==t&&(e.tabViewModel.activeTab=1),""==t&&(e.tabViewModel.activeTab=0)}),!0);for(var a=["","data","collections","profile"],o=0;o<a.length;o++)e.tabViewModel.tabs[o]={},e.tabViewModel.tabs[o].key=a[o],e.tabViewModel.tabs[o].data=[];e.findFeaturedContent=function(t){for(var i in e.artifactData.groups){var a=e.artifactData.groups[i];if(t==a.uri)return{type:"Group",label:a.label,uri:t,abstract:a.abstract};for(var o in a.artifacts){var n=a.artifacts[o];if(t==n.artifactUri)return{type:"Artifact",label:n.label,uri:t,abstract:n.abstract}}}for(var r in e.collectionsData.collections){var s=e.collectionsData.collections[r];if(t==s.uri)return{type:"Collection",label:s.label,uri:t,abstract:s.abstract}}},e.refreshFeaturedContent=function(){var t=e.profileData.featuredContent.split("\n");for(var i in e.featuredContent=[],t){var a=e.findFeaturedContent(t[i]);null!=a&&e.featuredContent.push(a)}},e.formatUploadSize=function(e){return DatabusUtils.formatFileSize(e)}}}function ArtifactPageController(e,t,i){e.collectionManager=i,setTimeout((function(){$(".dropdown-item").click((function(e){var t=$(this).closest(".dropdown");$(t).removeClass("is-active"),e.stopPropagation()})),$("body").click((function(){$(".dropdown").removeClass("is-active")})),$(".dropdown").click((function(e){$(".dropdown").removeClass("is-active"),$(this).addClass("is-active"),e.stopPropagation()}))}),500),e.formatUploadSize=function(e){return Math.round(100*e)/100},e.hideAutofill=function(){e.fileSelector.clearAutofill((function(){e.$apply()}))},e.formatResult=function(e){return t.trustAsHtml(e)},e.showCollectionModal=function(){$("#add-to-collection-modal").addClass("is-active")},e.hideCollectionModal=function(){$("#add-to-collection-modal").removeClass("is-active")},e.latestVersionData=data.versions[0],e.versionsData=data.versions,e.artifactURI=DatabusUtils.navigateUp(e.latestVersionData.versionUri),e.activeTab=0,e.authenticated=data.auth.authenticated,e.fileSelector={},e.fileSelector.config={},e.fileSelector.config.columns=[],e.fileSelector.config.columns.push({field:"version",label:"Version",width:"25%"}),e.fileSelector.config.columns.push({field:"variant",label:"Variant",width:"17%"}),e.fileSelector.config.columns.push({field:"format",label:"Format",width:"10%"}),e.fileSelector.config.columns.push({field:"compression",label:"Compression",width:"15%"});var a=new QueryBuilder;e.artifactNode=new QueryNode(e.artifactURI,"dataid:artifact"),e.artifactNode.setFacet("http://purl.org/dc/terms/hasVersion","$latest",!0),e.groupNode=new QueryNode(DatabusUtils.navigateUp(e.artifactURI),"dataid:group"),e.groupNode.addChild(e.artifactNode),e.collectionWidgetSelectionData={},e.collectionWidgetSelectionData.groupNode=e.groupNode,e.fileSelector.query=a.createFileQuery(e.artifactNode),e.fileSelector.fullQuery=a.createFullQuery(e.artifactNode),e.onFacetSettingsChanged=function(){e.fileSelector.query=a.createFileQuery(e.artifactNode),e.fileSelector.fullQuery=a.createFullQuery(e.artifactNode)},e.onFileSelectionChanged=function(t,i){e.fileSelector.numFiles=t,e.fileSelector.totalSize=i},e.formatId=function(e){return DatabusCollectionUtils.formatId(e)},e.formatDate=function(e){return moment(e).format("MMM Do YYYY")},e.addArtifactNodeToCollection=function(){null!=e.collectionManager.activeCollection&&(new DatabusCollectionWrapper(e.collectionManager.activeCollection).addArtifactNode(e.artifactURI,e.latestVersionData.label,e.fileSelector.settings),e.collectionManager.saveLocally(),e.statusCode=1)},e.changeCollection=function(t){e.authenticated&&e.collectionManager.setActive(t.uuid)},e.getStatusSuccess=function(){return!0},e.resetStatus=function(){e.statusCode=0},e.getStatusMessage=function(e){return"File selection has been has been added to your collection."}}function CollectionController(e,t,i,a){e.collection=new DatabusCollectionWrapper(data.collection),e.authenticated=data.auth.authenticated,e.activeTab=0,e.collectionViewModel={},e.collectionViewModel.downloadScript=[],e.collectionViewModel.downloadScript.length=3,e.collectionViewModel.downloadScript[0]=`query=$(curl -H "Accept:text/sparql" ${e.collection.uri})`,e.collectionViewModel.downloadScript[1]=`files=$(curl -H "Accept: text/csv" --data-urlencode "query=\${query}" ${DATABUS_RESOURCE_BASE_URL}/system/sparql | tail -n+2 | sed 's/"//g')`,e.collectionViewModel.downloadScript[2]='while IFS= read -r file ; do wget $file; done <<< "$files"',e.collectionViewModel.downloadManual="To fetch the query via *curl* run \n``` shell\n"+e.collectionViewModel.downloadScript[0]+"\n```\n\n\nTo download the files additionally run\n``` shell\n"+e.collectionViewModel.downloadScript[1]+"\n"+e.collectionViewModel.downloadScript[2]+"\n```",e.collectionQuery=e.collection.createQuery(),e.collectionManager=a,e.collectionFiles="",e.authenticated&&(e.username=data.auth.info.username),e.formatUploadSize=function(e){return DatabusUtils.formatFileSize(e)},e.markdownToHtml=function(e){var i=window.markdownit();return t.trustAsHtml(i.render(e))},e.editCopy=function(){if(!e.collectionManager.isInitialized)return;let t=e.collectionManager.createCopy(e.collection);e.collectionManager.setActive(t.uuid),window.location.href="/system/collection-editor"},e.createSnapshot=function(){if(!e.collectionManager.isInitialized)return;let t=e.collectionManager.createSnapshot(e.collection);console.log(t),e.collectionManager.setActive(t.uuid),window.location.href="/system/collection-editor"},e.editCollection=function(){if(!e.collectionManager.isInitialized)return;let t=e.collectionManager.getCollectionByUri(e.collection.uri);if(null===t)return console.log("editCollection failed due there is no collection with that uri: "+e.collection.uri),void e.editCopy();e.collectionManager.setActive(t.uuid),window.location.href="/system/collection-editor"},e.downloadAsJson=function(){DatabusCollectionUtils.exportToJsonFile(e.collection)},e.queryToClipboard=function(){DatabusCollectionUtils.copyStringToClipboard(e.collectionQuery),e.statusCode=DatabusResponse.COLLECTION_QUERY_COPIED_TO_CLIPBOARD},e.openInYasgui=function(){window.location.href="https://databus.dbpedia.org/yasgui?query="+encodeURIComponent(e.collectionQuery)},e.bashScriptToClipboard=function(){DatabusCollectionUtils.copyStringToClipboard(e.collectionViewModel.downloadScript[0]+"\n"+e.collectionViewModel.downloadScript[1]+"\n"+e.collectionViewModel.downloadScript[2]),e.statusCode=DatabusResponse.COLLECTION_BASH_COPIED_TO_CLIPBOARD},e.markdownToHtml=function(e){let i=window.markdownit();return t.trustAsHtml(i.render(e))},e.filesToClipboard=function(){DatabusCollectionUtils.copyStringToClipboard(e.collectionFiles),e.statusCode=DatabusResponse.COLLECTION_DOWNLOAD_URLS_COPIED_TO_CLIPBOARD},e.getStatusMessage=function(e){return DatabusResponse.Message[e]},e.getStatusSuccess=function(){return e.statusCode>=2e3&&e.statusCode<3e3},e.resetStatus=function(){e.statusCode=0}}function CollectionsEditorController(e,t,i,a,o){e.authenticated=data.auth.authenticated,e.accountName=data.auth.info.accountName,e.location=a,e.$watch("location.hash()",(function(t,i){null!=e.session&&(e.session.activeTab="import"!=t?"add"!=t?"query"!=t?"preview"!=t?"edit"!=t?0:1:2:3:4:5)}),!0),e.goToTab=function(e){a.hash(e),window.scrollTo(0,0)},e.logMeIn=function(){window.location="/system/login?redirectUrl="+encodeURIComponent(window.location)},e.createAccount=function(){window.location="/system/account"},e.authenticated&&(e.hasAccount=null!=data.auth.info.accountName,e.hasAccount&&(e.getCollectionJson=function(){var t=DatabusCollectionUtils.createCleanCopy(e.collectionManager.activeCollection);return delete t.uuid,t},e.collectionManager=o,e.collectionQuery=new DatabusCollectionWrapper(e.collectionManager.activeCollection).createQuery(),e.collectionJson=e.getCollectionJson(),e.session=JSON.parse(window.sessionStorage.getItem(`databus_collection_editor_session_${data.auth.info.accountName}`)),null==e.session&&(e.session={},e.session.activeTab=0,e.session.showDescription=!0,e.session.showGroups=o.activeCollection.content.generatedQuery.root.childNodes.length>0,e.session.showQueries=o.activeCollection.content.customQueries.length>0),0==o.activeCollection.content.generatedQuery.root.childNodes.length&&(e.session.showGroups=!1),0==o.activeCollection.content.customQueries.length&&(e.session.showQueries=!1),e.$watch("statusCode",(function(i,a){null!=e.timer&&t.cancel(e.timer),0!=e.statusCode&&(e.timer=t((function(){e.statusCode=0}),2e3))}),!0),e.$watch("session",(function(t,i){window.sessionStorage.setItem("databus_collection_editor_session",JSON.stringify(e.session))}),!0),e.form={},e.form.label={},e.form.identifier={},e.form.abstract={},e.form.description={},e.form.collectionPublishTag="",e.artifactData={},e.username=data.auth.info.accountName,e.modalTime=1e3,e.updateStatistics=function(t){if(void 0===t.uri)return e.statistics=null,void(e.files=null)},e.removeCustomNode=function(t){new DatabusCollectionWrapper(e.collectionManager.activeCollection).removeCustomQueryNode(t),e.onActiveCollectionChanged()},e.addCustomNode=function(){new DatabusCollectionWrapper(e.collectionManager.activeCollection).addCustomQueryNode("New Query","PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\n\n# Get all files\nSELECT DISTINCT ?file WHERE {\n  ?dataset dataid:artifact <https://databus.dbpedia.org/dbpedia/publication/strategy> .\n  ?dataset dcat:distribution ?distribution .\n  ?distribution dcat:downloadURL ?file .\n}"),e.session.showQueries=!0,e.onActiveCollectionChanged()},e.onCollectionClicked=function(t){t.uuid==e.collectionManager.activeCollection.uuid&&0==e.session.activeTab&&e.goToTab("edit"),e.setActiveCollection(t)},e.setActiveCollection=function(t){t.uuid!=e.collectionManager.activeCollection.uuid&&(e.collectionManager.setActive(t.uuid),e.updateStatistics(t),e.form.identifier.value=DatabusUtils.uriToName(e.collectionManager.activeCollection.uri))},e.doStuffWhenInitialized=function(){null==e.collectionManager.activeCollection&&e.collectionManager.selectFirstOrCreate(),e.setActiveCollection(e.collectionManager.activeCollection)},o.isInitialized?e.doStuffWhenInitialized():o.onReady=e.doStuffWhenInitialized,e.onActiveCollectionChanged=function(){e.collectionManager.saveLocally();let t=e.collectionManager.activeCollection;e.collectionQuery=new DatabusCollectionWrapper(t).createQuery(),e.collectionJson=e.getCollectionJson(),null!=t&&(t.hasLocalChanges=e.collectionManager.hasLocalChanges(t))},e.getStatusMessage=function(e){return DatabusResponse.Message[e]},e.getStatusSuccess=function(){return e.statusCode>=2e3&&e.statusCode<3e3},e.resetStatus=function(){e.statusCode=0},e.preview=function(){window.location.href="/"+e.username+"/collections/"+e.collectionManager.activeCollection.id},e.createNewCollection=function(){e.collectionManager.createNew("New Collection","Replace this description with a description of your choice.",(function(t){e.statusCode=t?2006:916,t&&(e.isCreateNewModalVisible=!1)}))},e.editCopy=function(){var t=e.collectionManager.createCopy(e.collectionManager.activeCollection);e.collectionManager.setActive(t.uuid)},e.createCollection=function(){if(e.collectionManager.isInitialized){var i=!1;DatabusCollectionUtils.checkIdentifier(e.form.identifier.value)||(e.form.identifier.error=DatabusResponse.COLLECTION_INVALID_ID,i=!0),DatabusCollectionUtils.checkCollectionForm(e.form,e.collectionManager.activeCollection)&&!i&&(e.isSaving=!0,e.collectionManager.commitCollection(e.username,e.form.identifier.value).then((function(i){e.statusCode=i.code,e.isSaving=!1,e.$apply(),e.updateStatistics(e.collectionManager.activeCollection),t(e.resetStatus,e.modalTime)})).catch((function(i){e.statusCode=i.code,e.isSaving=!1,e.$apply(),t(e.resetStatus,e.modalTime)})))}},e.saveCollection=function(){if(e.collectionManager.isInitialized){var i=void 0;null!=e.collectionManager.activeCollection.uri&&(i=DatabusUtils.uriToName(e.collectionManager.activeCollection.uri)),null==i&&(DatabusCollectionUtils.checkIdentifier(e.form.identifier.value)?(e.form.identifier.error=void 0,i=e.form.identifier.value):e.form.identifier.error=DatabusResponse.COLLECTION_INVALID_ID),DatabusCollectionUtils.checkCollectionForm(e.form,e.collectionManager.activeCollection)&&null!=i&&(e.isSaving=!0,e.collectionManager.updateCollection(e.username,i).then((function(i){e.statusCode=DatabusResponse.COLLECTION_UPDATED,e.isSaving=!1,e.$apply(),e.updateStatistics(e.collectionManager.activeCollection),t(e.resetStatus,e.modalTime)})).catch((function(i){e.statusCode=i.code,e.isSaving=!1,e.$apply(),t(e.resetStatus,e.modalTime)})))}},e.createDraft=function(){e.collectionManager.isInitialized&&e.collectionManager.createDraft((function(i){e.statusCode=i,e.isSaving=!1,t(e.resetStatus,e.modalTime)}))},e.showDeleteModal=function(){e.deleteModalVisible=!0},e.hideDeleteModal=function(){e.deleteModalVisible=!1},e.deleteCollection=function(){e.collectionManager.isInitialized&&(e.deleteModalVisible=!1,e.collectionManager.deleteCollection(e.username,e.form.identifier.value).then((function(i){e.statusCode=i.code,e.collectionManager.selectFirstOrCreate(),e.setActiveCollection(e.collectionManager.activeCollection),e.$apply(),t(e.resetStatus,e.modalTime)})).catch((function(i){e.statusCode=i.code,e.$apply(),t(e.resetStatus,e.modalTime)})))},e.unHideCollection=function(){var i=void 0;null!=e.collectionManager.activeCollection.uri&&(i=DatabusUtils.uriToName(e.collectionManager.activeCollection.uri)),null!=i&&e.collectionManager.unHideCollection(e.username,i).then((function(i){e.statusCode=DatabusResponse.COLLECTION_PUBLISHED,e.$apply(),t(e.resetStatus,e.modalTime)})).catch((function(i){e.statusCode=i.code,e.$apply(),t(e.resetStatus,e.modalTime)}))},e.hideCollection=function(){var i=void 0;null!=e.collectionManager.activeCollection.uri&&(i=DatabusUtils.uriToName(e.collectionManager.activeCollection.uri)),null!=i&&e.collectionManager.hideCollection(e.username,i).then((function(i){e.statusCode=DatabusResponse.COLLECTION_UNPUBLISHED,e.$apply(),t(e.resetStatus,e.modalTime)})).catch((function(i){e.statusCode=i.code,e.$apply(),t(e.resetStatus,e.modalTime)}))},e.deleteLocally=function(){e.collectionManager.isInitialized&&e.collectionManager.deleteLocally((function(t){e.statusCode=t.code}))},e.downloadAsJson=function(){DatabusCollectionUtils.exportToJsonFile(e.collectionManager.activeCollection)},e.discardChanges=function(){e.isDoingCommitWork=!0,i.get(`/system/pages/account/collections?account=${e.accountName}`).then((function(t){e.collectionManager.discardLocalChanges(t.data),e.statusCode=DatabusResponse.COLLECTION_LOCAL_CHANGES_DISCARDED,e.isDoingCommitWork=!1}))},e.queryToClipboard=function(){var t=DatabusCollectionUtils.createQueryString(e.collectionManager.activeCollection);DatabusCollectionUtils.copyStringToClipboard(t),e.statusCode=DatabusResponse.COLLECTION_QUERY_COPIED_TO_CLIPBOARD},e.showLoadFromJson=function(){e.isLoadFromJsonVisible=!0},e.hideLoadFromJson=function(){e.isLoadFromJsonVisible=!1},e.loadFromJsonString="",e.loadFromJson=function(t){try{var i=JSON.parse(t),a=e.collectionManager.activeCollection;a.label=i.label,a.description=i.description,a.abstract=i.abstract,a.content=i.content,e.statusCode=DatabusResponse.COLLECTION_IMPORTED,e.isLoadFromJsonVisible=!1}catch(t){e.statusCode=DatabusResponse.COLLECTION_IMPORTED_FAILED}}))}function DocumentationController(e,t){e.content=data.content,angular.element(document).ready((function(){var e=initTOC({selector:"h1, h2, h3, h4, h5, h6",scope:"#content",overwrite:!1,prefix:"toc"});$("#toc").append(e)})),e.markdownToHtml=function(e){var i=window.markdownit("commonmark");return t.trustAsHtml(i.render(e))}}function FrontPageController(e,t){for(var i in e.activityChartData=data.activityData,e.recentUploadsData=data.recentUploadsData,e.uploadRankingData=data.rankingData,e.auth=data.auth,e.formatUploadSize=function(e){return Math.round(100*e)/100},e.uploadRankingData)e.uploadRankingData[i].uploadSize=e.formatUploadSize(e.uploadRankingData[i].uploadSize);for(var i in e.formatDate=function(e){return moment(e).format("MMM Do YYYY")+" ("+moment(e).fromNow()+")"},e.formatLicense=function(e){var i='<div class="license-icon is-primary">'+DatabusUtils.uriToName(e)+"</div>";return t.trustAsHtml(i)},e.recentUploadsData)e.recentUploadsData[i].date=e.formatDate(e.recentUploadsData[i].date),e.recentUploadsData[i].licenseTag=e.formatLicense(e.recentUploadsData[i].license)}function GroupPageController(e,t,i,a,o){e.group=data.group,e.artifacts=data.artifacts,e.services=data.services,e.facetsView={},e.facetsView.resourceUri=e.group.uri,e.facetsView.settings=[],e.facetsView.parentSettings=null,e.activeTab=0,e.authenticated=data.auth.authenticated,e.selection=[],e.searchInput="",e.searchCooldown=500,e.searchChanged=!0,e.searchReady=!0,e.fileSelector={},e.fileSelector.config={},e.fileSelector.config.columns=[],e.fileSelector.config.columns.push({field:"artifact",label:"Artifact",width:"32%",uriToName:!0}),e.fileSelector.config.columns.push({field:"version",label:"Version",width:"12%"}),e.fileSelector.config.columns.push({field:"variant",label:"Variant",width:"17%"}),e.fileSelector.config.columns.push({field:"format",label:"Format",width:"8%"}),e.fileSelector.config.columns.push({field:"compression",label:"Compression",width:"10%"});var n=new QueryBuilder;for(var r in e.groupNode=new QueryNode(e.group.uri,"dataid:group"),e.groupNode.setFacet("http://purl.org/dc/terms/hasVersion","$latest",!0),e.fileSelector.query=n.createFileQuery(e.groupNode),e.fileSelector.fullQuery=n.createFullQuery(e.groupNode),e.onFacetSettingsChanged=function(){e.fileSelector.query=n.createFileQuery(e.groupNode),e.fileSelector.fullQuery=n.createFullQuery(e.groupNode)},e.collectionWidgetSelectionData={},e.collectionWidgetSelectionData.groupNode=e.groupNode,e.onFileQueryResult=function(t){null!=t&&(e.collectionWidgetSelectionData.query=t.query)},e.collectionManager=o,e.findArtifact=function(t){return e.artifacts.find((function(e){e.artifactUri}))},e.formatResult=function(e){return i.trustAsHtml(e)},e.formatDate=function(e){return moment(e).format("MMM Do YYYY")+" ("+moment(e).fromNow()+")"},e.formatLicense=function(e){var t='<div class="license-icon">'+DatabusUtils.uriToName(e)+"</div>";return i.trustAsHtml(t)},e.artifacts)e.artifacts[r].date=e.formatDate(e.artifacts[r].date),e.artifacts[r].licenseTag=e.formatLicense(e.artifacts[r].license);e.setSelectionStateAll=function(t){if(t)for(var i in e.artifacts)e.select(e.artifacts[i]);else for(var i in e.artifacts)e.deselect(e.artifacts[i])},e.toggleSelect=function(t){e.isSelected(t)?e.deselect(t):e.select(t)},e.select=function(t){t.isSelected=!0,e.selection.push(t.artifactUri)},e.deselect=function(t){t.isSelected=!1,e.selection=e.selection.filter((function(e,i,a){return e!==t.artifactUri}))},e.isSelected=function(t){for(var i in e.selection)if(e.selection[i]===t.artifactUri)return!0;return!1},e.changeCollection=function(t){e.collectionManager.setActive(t.uuid),e.search()},e.showCollectionModal=function(){$("#add-to-collection-modal").addClass("is-active")},e.hideCollectionModal=function(){$("#add-to-collection-modal").removeClass("is-active")},e.markdownToHtml=function(e){var t=window.markdownit();return i.trustAsHtml(t.render(e))},e.invokeSearch=function(){e.searchReady?(e.search(),e.searchReady=!1):e.searchChanged=!0},a((function(){e.searchChanged&&(e.search(),e.searchChanged=!1),e.searchReady=!0}),e.searchCooldown),e.addSelectionToCollection=function(){if(null!=e.collectionManager.activeCollection){var t=new DatabusCollectionWrapper(e.collectionManager.activeCollection);for(var i in e.selection){var a=e.artifacts.find((function(t){return t.artifactUri===e.selection[i]}));t.addArtifactNode(a.artifactUri,a.label)}e.collectionManager.saveLocally(),e.search()}},e.updateArtifactState=function(t,i){i.alreadyAdded=t.hasArtifact(i.artifactUri),i.isSelected=i.alreadyAdded||e.selection.includes(i.artifactUri)},e.search=function(){if(""!==e.searchInput){var i="&typeName=Artifact&groupUriWeight=0.0&groupUri="+e.group.uri+"&minRelevance=0.1";t({method:"GET",url:"/system/api/search?query="+e.searchInput+i}).then((function(t){for(var i in e.artifacts=[],t.data.docs){var a=t.data.docs[i],o={label:a.label[0],desc:a.comment[0],artifactUri:a.resource[0]};if(null!=e.collectionManager.activeCollection){var n=new DatabusCollectionWrapper(e.collectionManager.activeCollection);e.updateArtifactState(n,o)}e.artifacts.push(o)}}),(function(e){}))}else{if(e.artifacts=data.artifacts,null==e.collectionManager.activeCollection)return;for(var a in e.artifacts){var o=new DatabusCollectionWrapper(e.collectionManager.activeCollection);e.updateArtifactState(o,e.artifacts[a])}}}}function HeaderController(e,t,i){e.auth=data.auth,e.authenticated=data.auth.authenticated,e.databusCookieConsentKey="databus_cookie_consent";let a=window.localStorage.getItem(e.databusCookieConsentKey);e.showCookieDialogue=void 0===a,e.collectionManager=i,e.authenticated&&!e.collectionManager.isInitialized&&t.get(`/system/pages/account/collections?account=${e.auth.info.accountName}`).then((function(t){e.collectionManager.initialize(t.data)})),e.getAccountName=function(){return e.auth.info.accountName?e.auth.info.accountName:e.auth.info.oidc_email?e.auth.info.oidc_email:e.auth.info.oidc_name?e.auth.info.oidc_name:null},e.collectionManager.isInitialized&&e.collectionManager.findActive(),e.isMenuActive=!1,e.login=function(){window.location="/system/login?redirectUrl="+encodeURIComponent(window.location)},e.giveCookieConsent=function(){window.localStorage.setItem(e.databusCookieConsentKey,!0),e.showCookieDialogue=!1},e.logout=function(){window.location="/system/logout?redirectUrl="+encodeURIComponent(window.location)},setTimeout((function(){e.$watch((function(){return e.size()}),(function(e,t){""!=e&&($("#cart-icon").addClass("pulseit"),setTimeout((function(){$("#cart-icon").removeClass("pulseit")}),600))}))}),500),e.size=function(){if(null==e.collectionManager)return"";var t=e.collectionManager.current;return null!=t?t.elements.length:""},e.register=function(){},e.manageAccount=function(){}}function ProfileController(e,t){e.profileData=data.profile,e.auth=data.auth,e.preferredDatabusUsername="",e.apiKeys=data.auth.info.apiKeys,e.createApiKeyName="",e.createAccountError="",e.createApiKeyError="",e.addWebIdUri="",e.personUri=`${DATABUS_RESOURCE_BASE_URL}/${e.auth.info.accountName}#this`,e.putProfile=function(i,a){var o=`${DATABUS_RESOURCE_BASE_URL}/${i}`,n=`${DATABUS_RESOURCE_BASE_URL}/${i}#this`,r={"@graph":[{"@id":n,"@type":["http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/DBpedian"],"http://xmlns.com/foaf/0.1/account":{"@id":o},"http://xmlns.com/foaf/0.1/img":{"@id":""},"http://xmlns.com/foaf/0.1/name":a},{"@id":o,"@type":"http://xmlns.com/foaf/0.1/PersonalProfileDocument","http://xmlns.com/foaf/0.1/maker":{"@id":n},"http://xmlns.com/foaf/0.1/primaryTopic":{"@id":n}}]};t.put(`/${i}`,r).then((function(e){e.data.code==DatabusResponse.USER_PROFILE_CREATED&&window.location.reload(!0)}),(function(t){console.log(t),e.createAccountError=t.data}))},null!=e.profileData?(e.removeApiKey=function(i){t.post(`/system/account/api-key/delete?key=${i}`).then((function(t){e.apiKeys=e.apiKeys.filter((function(e){return e.key!=i}))}),(function(t){console.log(t),e.createApiKeyError=t.data}))},e.copyToClipboard=function(e){DatabusUtils.copyStringToClipboard(e)},e.addApiKey=function(){t.post(`/system/account/api-key/create?name=${encodeURIComponent(e.createApiKeyName)}`).then((function(t){e.apiKeys.push(t.data)}),(function(t){console.log(t),e.createApiKeyError=t.data}))},e.connectWebid=function(){t.post(`/system/account/webid/connect?uri=${encodeURIComponent(e.addWebIdUri)}`).then((function(t){e.profileData.webIds.push(e.addWebIdUri)}),(function(t){console.log(t),e.addWebIdError=t.data}))},e.removeWebId=function(i){t.post(`/system/account/webid/remove?uri=${encodeURIComponent(i)}`).then((function(t){e.profileData.webIds=e.profileData.webIds.filter((function(e,t,a){return e!=i}))}),(function(t){console.log(t),e.addWebIdError=t.data}))},e.saveProfile=function(){if(e.auth.authenticated){var i=`${DATABUS_RESOURCE_BASE_URL}/${e.auth.info.accountName}`,a=`${DATABUS_RESOURCE_BASE_URL}/${e.auth.info.accountName}#this`,o={"@context":JSONLD_CONTEXT,"@graph":[{"@id":i,"@type":"foaf:PersonalProfileDocument",maker:a,primaryTopic:a},{"@id":a,"@type":["dbo:DBpedian","foaf:Person"],name:e.editData.label,"rdfs:comment":e.editData.about,account:i,img:e.editData.imageUrl}]};null!=e.editData.webIdURI&&""!=e.editData.webIdURI&&o["@graph"].push({"@id":e.editData.webIdURI,account:i}),t.put("/"+e.auth.info.accountName,o).then((function(e){e.data.code==DatabusResponse.USER_PROFILE_UPDATED&&window.location.reload(!0)}),(function(e){console.log(e)}))}},e.profileData.isOwn&&(e.editData=DatabusUtils.createCleanCopy(e.profileData),e.resetEdits=function(){e.editData=DatabusUtils.createCleanCopy(e.profileData)})):e.createProfile=function(){if(e.auth.authenticated){var t=e.preferredDatabusUsername;if(null==t||!DatabusUtils.isValidAccountName(t))return e.createAccountError="Enter a valid account name.",void(e.showAccountNameHints=!0);var i=t;e.auth.info.oidc_name&&(i=e.auth.info.oidc_name),e.showAccountNameHints=!1,e.putProfile(t,i,"")}}}function PublishWizardController(e,t,i,o){if(e.authenticated=data.auth.authenticated,e.logMeIn=function(){window.location="/system/login?redirectUrl="+encodeURIComponent(window.location)},e.createAccount=function(){window.location="/system/account"},e.authenticated&&(e.hasAccount=null!=data.auth.info.accountName,e.hasAccount)){e.uploadSessionStorageKey="databus_upload",e.uploadSessionStorageIgnoreKeys=["$$hashKey","eventListeners","hasLocalChanges","fileFilterInput","fileSuggestions","progress","streamQueue"],e.result={},e.watchSession=function(){return e.$watch("session",(function(t,i){e.session.data.validate(),null!=e.session.dataIdCreator&&(e.result.updateData=e.session.dataIdCreator.createUpdate(e.session.data),e.result.groupUpdate=e.session.dataIdCreator.createGroupUpdate(e.session.data),e.result.versionUpdate=e.session.dataIdCreator.createVersionUpdate(e.session.data),e.result.isReadyForUpload=e.checkReadyForUpload(),e.result.isReadyForUpload&&e.createTractate(e.result.versionUpdate)),e.saveSession()}),!0)},e.saveSession=function(){try{var t=JSON.stringify(e.session,(function(t,i){if(!e.uploadSessionStorageIgnoreKeys.includes(t))return i}));window.sessionStorage.setItem(e.uploadSessionStorageKey,t)}catch(e){console.log(e)}},e.createSignatureData=function(){var e={publisherUris:[]};for(var t in data.publisherData)e.publisherUris.push(data.publisherData[t].publisherUri);return e.defaultPublisherUri=`${DATABUS_RESOURCE_BASE_URL}/${data.auth.info.accountName}#this`,e.selectedPublisherUri=e.defaultPublisherUri,e.autoGenerateSignature=!0,e.autoGenerateSignatureLocked=!1,e.userSignature="",e},e.createNewSession=function(){var t={};t.data=new PublishData,t.data.validate(),t.showContext=!1,t.fetchFilesInput="",t.addFileInput="",t.activeStepIndex=0,t.accountName=data.auth.info.accountName,t.isAccountDataLoading=!0,t.data.signature=e.createSignatureData(),t.dataIdCreator=new DataIdCreator(t.accountName),t.shasumClient=new ShasumClient(o,"/system/publish/file?url=",3),e.session=t,e.saveSession(),window.location.href=window.location.protocol+"//"+window.location.host+window.location.pathname},e.resumeSession=function(){if(e.session=JSON.parse(window.sessionStorage.getItem(e.uploadSessionStorageKey)),null!=e.session){e.session.data=new PublishData(e.session.data);var t=e.session.data.signature;for(var i in t.defaultPublisherUri=`${DATABUS_RESOURCE_BASE_URL}/${data.auth.info.accountName}#this`,t.publisherUris=[],data.publisherData)t.publisherUris.push(data.publisherData[i].publisherUri);t.publisherUris.includes(t.selectedPublisherUri)||(t.selectedPublisherUri=t.defaultPublisherUri),e.session.dataIdCreator=new DataIdCreator(e.session.accountName),e.session.shasumClient=new ShasumClient(o,"/system/publish/file?url=",3),e.session.isPublishing=!1}};try{e.resumeSession(),null!=e.session&&e.session.isOver&&(e.session=null),null!=e.session&&e.session.accountName!=data.auth.info.accountName&&(e.session=null)}catch(t){console.log(t),e.session=null}null==e.session&&e.createNewSession(),e.stopTheWatch=e.watchSession(),e.isWizardReady=!1,e.onSelectPublisher=function(t){var i=e.session.data.signature;i.selectedPublisherUri=t;var a=i.defaultPublisherUri==t;i.autoGenerateSignature=a,i.autoGenerateSignatureLocked=!a},e.hints={},e.hints.files=["Use the file panel to fetch file URLs from resource pages or single file URLs. Fetching the URL verifies that the file is reachable and detects the file format and compression.","Files with the same name but different formats will be grouped and displayed as a single entry in the file panel. Use the arrow button to expand the entry in order to display the detected formats."],e.hints.group=["A Databus Group is a structure to help you organize your data artifacts.","If you wanted to upload multiple artifacts about a common topic, a Databus Group provides a way to reflect this commonality.","When uploading artifacts about fish, birds and mammals it would make sense to upload these in a group labelled 'animals'. The web interface only allows uploads to a single group per upload. The group 'general' will be selected by default."],e.hints.artifact=["A Databus Artifact is a logical dataset on the Databus. It may consist of multiple files in different formats or variants that describe the same thing or topic.","For example, an Artifact labelled <b>Fish</b> could contain three files in different languages. All files would still contain information about fish.","You can update new versions of your Databus Artifact anytime you like. The Artifact identifier remains static and allows users to access all released versions of your data"],e.hints.variants=["All files of a Databus Artifact have to be distinguishable by more than just the file name. Therefore, each file of an Artifact has to differ in at least one content variant dimension.","For example, if you wanted to upload multiple translations of a text (each in its own file), the Databus would not auto-detect the aspect that makes each file different. You would have to tell the Databus manually that the text files contain the same text in different languages.","You can add content variants to files by adding a content variant dimension (e.g. 'language' or 'lang') and inserting values (e.g. 'en', 'de', 'fr', ...) into the newly created column. "],e.errorMessages={err_invalid_group_description:"The group description is invalid. Please enter at least 25 characters.",err_invalid_group_abstract:"The group abstract is invalid. Please enter at least 25 characters (plain text).",err_invalid_group_label:"The group label is invalid. Please enter at least 3 characters.",err_invalid_group_id:"The group id is invalid. Please enter at least 3 characters.",err_invalid_artifact_id:"The artifact id is invalid. Please enter at least 3 characters.",err_invalid_artifact_label:"The artifact label is invalid. Please enter at least 3 characters.",err_invalid_artifact_abstract:"The artifact abstract is invalid. Please enter at least 25 characters (plain text).",err_invalid_version_id:"The version id is invalid. Please enter at least 3 characters.",err_invalid_version_description:"The version documentation is invalid. Please enter at least 25 characters.",err_invalid_version_license:"The license is invalid. Please enter a license URI.",err_no_files:"You have to upload at least one file.",err_not_analyzed:"This file has not been analzyed yet."},e.setCreateNewGroup=function(t){var i=e.session.data.group;if(t)i.createNew=!0,i.id="",i.label="",i.abstract="",i.description="",e.session.accountGroup=null,e.setCreateNewArtifact(!0);else{if(!(DatabusUtils.objSize(e.session.accountData)>0))return void e.setCreateNewGroup(!0);if(null==e.session.accountGroup)for(var a in e.session.accountData){var o=e.session.accountData[a];e.selectGroup(o);break}}},e.setCreateNewArtifact=function(t){var i=e.session.data.artifact;if(t)i.createNew=t,i.id="",i.label="",i.abstract="",i.description="",e.session.accountArtifact=null;else if(DatabusUtils.objSize(e.session.accountGroup.artifacts)>0||e.setCreateNewArtifact(!0),null==e.session.accountArtifact)for(a in e.session.accountGroup.artifacts){var o=e.session.accountGroup.artifacts[a];e.selectArtifact(o);break}},e.selectArtifact=function(t){var i=e.session.data.artifact;i.id=t.id,i.label=t.label,i.abstract=t.abstract,e.accountArtifact=t},e.selectGroup=function(t){var i=e.session.data.group,a=e.session.data.artifact;i.id=t.id,i.label=t.label,i.abstract=t.abstract,i.description=t.description,e.session.accountGroup!=t&&(e.session.accountGroup=t,e.session.accountArtifact=null,e.setCreateNewArtifact(a.createNew))},e.fetchGroupsAndArtifacts=function(){var i=e.session,a=`/system/pages/account/artifacts?account=${encodeURIComponent(i.accountName)}`;t.get(a).then((function(t){i.isAccountDataLoading=!1,i.accountData=t.data,e.isWizardReady=!0}),(function(e){console.log(e)}))},e.objSize=function(e){return DatabusUtils.objSize(e)},e.checkReadyForUpload=function(){var t=e.session.data.group,i=e.session.data.artifact,a=e.session.data.version;if(t.errors.length>0)return!1;if(i.errors.length>0)return!1;if(a.errors.length>0)return!1;for(var o in a.files)if(a.files[o].errors.length>0)return!1;return!0},e.hasError=function(e,t){for(var i in e)if(e[i]==t)return!0;return!1},e.addFile=function(i){var a=e.session;null!=i&&0!=i.length&&t.get("/system/publish/fetch-file?url="+encodeURIComponent(i)).then((function(t){null!=t.data&&""!=t.data&&200==t.status&&(a.data.addFile(t.data),e.saveSession())}),(function(e){}))},e.analyzeFile=function(t){e.session.shasumClient.analyzeFile(t)},e.removeFile=function(t){var i=e.session.data.version.files;i.splice(i.findIndex((e=>e.uri==t.uri)),1),e.session.data.version.isConfigDirty=!0},e.fetchFiles=function(i){t.get("/system/api/fetch-resource-page?url="+encodeURIComponent(i)).then((function(t){for(var i in t.data){var a=t.data[i];e.addFile(a)}}),(function(e){}))},e.publish=function(){e.session.isPublishing=!0,e.runPublishSequence()},e.postDeferred=function(t){var i=o.defer();return fetch("/system/publish",{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(t)}).then((function(t){var a=new TextDecoder("utf-8");!function t(o){return o.read().then((({done:n,value:r})=>{var s=a.decode(r).split("\n");for(var l of s)e.result.publishLog.push({hasError:!1,message:l});if(e.$apply(),n)return i.resolve({status:"ok"}),!0;t(o)}),(function(e){i.reject({message:e})}))}(t.body.getReader())}),(function(e){i.reject({message:e})})),i.promise},e.runPublishSequence=async function(){var t=e.result;t.publishLog=[];try{await e.postDeferred(t.updateData),e.session.isPublishing=!1,e.$apply()}catch(i){t.publishLog.push({hasError:!0,message:i.data}),e.session.isPublishing=!1,e.$apply()}},e.createTractate=function(i){t.post("/system/tractate/v1/canonicalize",i).then((function(t){e.session.data.signature.tractate=t.data}),(function(e){console.log(e)}))},e.getArtifact=function(t,i){var a=e.session.groups;if(null!=a[t]&&null!=a[t].artifacts[i])return a[t].artifacts[i]},e.onRemoveDistribution=function(t){if(null!=t.artifactId){var i=e.getArtifact(t.groupId,t.artifactId);e.removeDistributionFromArtifact(i,t)}else e.distributions=e.distributions.filter((function(e){return e.uri!=t.uri}));e.saveSession()},e.fetchGroupsAndArtifacts()}}function VersionPageController(e,t,i){setTimeout((function(){$(".dropdown-item").click((function(e){var t=$(this).closest(".dropdown");$(t).removeClass("is-active"),e.stopPropagation()})),$("body").click((function(){$(".dropdown").removeClass("is-active")})),$(".dropdown").click((function(e){$(".dropdown").removeClass("is-active"),$(this).addClass("is-active"),e.stopPropagation()}))}),500),e.collectionManager=i,e.actions=data.actions,e.versionData=data.version,e.serviceData=data.services,e.modsData=data.mods,e.queryResult={},e.addToCollectionQuery="",e.authenticated=data.auth.authenticated,e.collectionModalVisible=!1,e.versionData.publisherUri=DatabusUtils.navigateUp(DatabusUtils.navigateUp(e.versionData.artifactUri)),e.versionData.publisher=DatabusUtils.uriToName(e.versionData.publisherUri),e.modsAmountMinimized=5,e.modsMaxAmount=e.modsAmountMinimized,e.showAllMods=function(){e.modsMaxAmount=1e7},e.hideAllMods=function(){e.modsMaxAmount=e.modsAmountMinimized},e.fileSelector={},e.fileSelector.config={},e.fileSelector.config.columns=[],e.fileSelector.config.columns.push({field:"variant",label:"Variant",width:"25%"}),e.fileSelector.config.columns.push({field:"format",label:"Format",width:"25%"}),e.fileSelector.config.columns.push({field:"compression",label:"Compression",width:"25%"});var a=new QueryBuilder;e.artifactNode=new QueryNode(e.versionData.artifactUri,"dataid:artifact"),e.artifactNode.setFacet("http://purl.org/dc/terms/hasVersion",e.versionData.version,!0),e.groupNode=new QueryNode(DatabusCollectionUtils.navigateUp(e.versionData.uri),"dataid:group"),e.groupNode.addChild(e.artifactNode),e.collectionWidgetSelectionData={},e.collectionWidgetSelectionData.groupNode=e.groupNode,e.fileSelector.query=a.createFileQuery(e.artifactNode),e.fileSelector.fullQuery=a.createFullQuery(e.artifactNode),e.onFacetSettingsChanged=function(){e.fileSelector.query=a.createFileQuery(e.artifactNode),e.fileSelector.fullQuery=a.createFullQuery(e.artifactNode)},e.hideAutofill=function(){e.fileSelector.clearAutofill((function(){e.$apply()}))},e.onFileSelectionChanged=function(t,i,a){e.addToCollectionQuery=a},e.showCollectionModal=function(){e.collectionModalVisible=!0},e.hideCollectionModal=function(){e.collectionModalVisible=!1},e.addFilter=function(t,i){e.fileSelector.addFilter(t,i),e.updateQueryBuilder()},e.addQueryToCollection=function(){e.collectionManager.addElement(e.queryBuilder.query),e.hideCollectionModal()},e.formatUploadSize=function(e){return DatabusUtils.formatFileSize(e)},e.formatDate=function(e){return moment(e).format("MMM Do YYYY")},e.formatId=function(e){return DatabusCollectionUtils.formatId(e)},e.addQueryToCollection=function(){null!=e.collectionManager.activeCollection&&(new DatabusCollectionWrapper(e.collectionManager.activeCollection).addCustomQueryNode("Select "+e.versionData.label+" files",e.addToCollectionQuery),e.collectionManager.saveLocally(),e.collectionModalVisible=!1)},e.formatMods=function(e){var i=e.replace(",","&nbsp;");return t.trustAsHtml(i)},e.formatModFile=function(e){return DatabusCollectionUtils.uriToName(e)},e.markdownToHtml=function(e){var i=window.markdownit();return t.trustAsHtml(i.render(e))}}class DataIdCreator{constructor(e){this.accountName=e}createUpdate(e){var t=this.createGroupUpdate(e),i=this.createVersionUpdate(e),a={"@context":"https://downloads.dbpedia.org/databus/context.jsonld","@graph":[]};for(var o of t["@graph"])a["@graph"].push(o);for(var o of i["@graph"])a["@graph"].push(o);return a}createGroupUpdate(e){return{"@context":"https://downloads.dbpedia.org/databus/context.jsonld","@graph":[{"@id":`${`${DATABUS_RESOURCE_BASE_URL}/${this.accountName}`}/${e.group.id}`,"@type":"Group",title:e.group.label,abstract:e.group.abstract,description:e.group.description}]}}createVersionUpdate(e){var t=`${DATABUS_RESOURCE_BASE_URL}/${this.accountName}`+"/"+e.group.id,i=e.artifact,a=e.version,o=(i.id,t+"/"+i.id+"/"+a.id),n={"@type":"Dataset","@id":o+"#Dataset",publisher:e.signature.selectedPublisherUri,hasVersion:a.id,title:i.label,abstract:i.abstract,description:a.description,license:a.license,distribution:[]};e.signature.selectedPublisherUri==e.signature.defaultPublisherUri&&delete n.publisher,e.signature.autoGenerateSignature||(n["sec:proof"]={"@type":["dataid:DatabusTractateV1"],"sec:signature":[{"@type":"http://www.w3.org/2001/XMLSchema#string","@value":e.signature.userSignature}]});var r=[];for(var s in a.files){var l=a.files[s],c="";for(var u in a.contentVariants){var d=a.contentVariants[u];null==(g=l.contentVariants[d.id])&&(g=""),c+="_"+d.id+"="+g}var h=DatabusUtils.uriToName(l.uri),f=`${o}#${h}`,p=`${o}/${h}${c}`;f+=c,"none"!=l.format&&(f+="."+l.format,p+="."+l.format),"none"!=l.compression&&(f+="."+l.compression,p+="."+l.compression);var v={"@id":f,"@type":"Part",file:p,format:l.format,compression:l.compression,downloadURL:l.uri,byteSize:l.byteSize,sha256sum:l.sha256sum};for(var u in a.contentVariants){var g;d=a.contentVariants[u];null==(g=l.contentVariants[d.id])&&(g=""),v["dataid-cv:"+d.id]=g,r.includes(d.id)||r.push(d.id)}n.distribution.push(v)}var m={"@context":"https://downloads.dbpedia.org/databus/context.jsonld","@graph":[n]};for(var u in r){d=r[u];m["@graph"].push({"@type":"rdf:Property","@id":`http://dataid.dbpedia.org/ns/cv#${d}`,"rdfs:subPropertyOf":{"@id":"dataid:contentVariant"}})}return m}}class ShasumClient{constructor(e,t,i){this.proxyUri=t,this.q=e,this.maxStreams=i,this.processes={},this.streamQueue=[]}getActiveProcessCount(){var e=0;for(var t in this.processes)this.processes[t].isDone||e++;return e}analyzeFile(e){this.getActiveProcessCount()<this.maxStreams?this.startSha256Task(e):this.streamQueue.push(e)}analyzeAllFiles(e){for(var t in this.processes={},this.streamQueue=[],fileGroups){var i=fileGroups[t];for(var a in i.distributions){var o=i.distributions[a];this.streamQueue.push(o)}}for(var n=0;n<Math.min(this.streamQueue.length,this.maxStreams);n++)this.startSha256Task(this.streamQueue[n]);return this.streamQueue.splice(0,this.maxStreams),this.shasumCreationProcess}startShasumGeneration(e){for(var t in this.processes={},this.streamQueue=[],e){var i=e[t];for(var a in i.distributions){var o=i.distributions[a];this.streamQueue.push(o)}}for(var n=0;n<Math.min(this.streamQueue.length,this.maxStreams);n++)this.startSha256Task(this.streamQueue[n]);return this.streamQueue.splice(0,this.maxStreams),this.shasumCreationProcess}hasError(e){for(var t in e.distributions){var i=e.distributions[t];if(this.processes[i.uri].hasError)return!0}return!1}isSuccess(e){for(var t in e.distributions){var i=e.distributions[t],a=this.processes[i.uri];if(null==a||!a.isDone||a.hasError)return!1}return!0}isDone(){if(this.streamQueue>0)return!1;for(var e in this.processes)if(!this.processes[e].isDone)return!1;return!0}onShasumFinished(){this.streamQueue.length>0&&(this.startSha256Task(this.streamQueue[0]),this.streamQueue.splice(0,1))}startSha256Task=function(e){var t={isDone:!1},i=this;this.generateSha256Deferred(e).then((function(a){t.result=a.result,t.isDone=!0,t.isSuccess=!0,e.byteSize=a.result.byteSize,e.sha256sum=a.result.sha256sum,i.onShasumFinished()}),(function(e){t.result=e,t.isDone=!0,t.hasError=!0,i.onShasumFinished()}),(function(e){t.progress=e.progress})),this.processes[e.uri]=t};generateSha256Deferred=function(e){var t=this.q.defer(),i=this.proxyUri+encodeURIComponent(e.uri);return fetch(i,{headers:this.authHeader,credentials:"include"}).then((function(i){var a=0,o=null,n=new TextDecoder("utf-8");!function i(r){return r.read().then((({done:s,value:l})=>{var c=n.decode(l).split("$");for(var u in c){var d=c[u];if(d.includes("/")){var h=c[u].split("/");t.notify({uri:e.uri,progress:Math.floor(100*h[0]/h[1])}),a=h[1]}else null!=c&&d.length>0&&(o=d)}if(s)return t.resolve({uri:e.uri,result:{sha256sum:o,byteSize:a}}),!0;i(r)}),(function(i){t.reject({uri:e.uri,message:i})}))}(i.body.getReader())}),(function(i){t.reject({uri:e.uri,message:i})})),t.promise}}class PublishData{constructor(e){this.group=null!=e?e.group:{},this.artifact=null!=e?e.artifact:{},this.version=null!=e?e.version:{},this.signature=null!=e?e.signature:void 0}validate(){var e=!1;if(this.group.errors=[],DatabusUtils.isValidResourceIdentifier(this.group.id,3)||(this.group.errors.push("err_invalid_group_id"),e=!0),DatabusUtils.isValidResourceLabel(this.group.label,3)||(this.group.errors.push("err_invalid_group_label"),e=!0),DatabusUtils.isValidResourceText(this.group.abstract,25)||(this.group.errors.push("err_invalid_group_abstract"),e=!0),DatabusUtils.isValidResourceText(this.group.description,25)||(this.group.errors.push("err_invalid_group_description"),e=!0),this.artifact.errors=[],DatabusUtils.isValidResourceIdentifier(this.artifact.id)||(this.artifact.errors.push("err_invalid_artifact_id"),e=!0),DatabusUtils.isValidResourceLabel(this.artifact.label,3)||(this.artifact.errors.push("err_invalid_artifact_label"),e=!0),DatabusUtils.isValidResourceText(this.artifact.abstract,25)||(this.artifact.errors.push("err_invalid_artifact_abstract"),e=!0),this.version.errors=[],DatabusUtils.isValidVersionIdentifier(this.version.id)||(this.version.errors.push("err_invalid_version_id"),e=!0),DatabusUtils.isValidUrl(this.version.license)||(this.version.errors.push("err_invalid_version_license"),e=!0),DatabusUtils.isValidResourceText(this.version.description,25)||(this.version.errors.push("err_invalid_version_description"),e=!0),0==DatabusUtils.objSize(this.version.files)&&(this.version.errors.push("err_no_files"),e=!0),this.version.isConfigDirty){var t=[];for(var i in this.version.files)this.version.files[i].errors=[],t.push(this.version.files[i]);this.cvSplit(this.version,t,0),this.version.isConfigDirty=!1}for(var i in this.version.files){var a=this.version.files[i];null==this.version.files[i].errors&&(this.version.files[i].errors=[]);var o=a.errors.findIndex((e=>"err_file_not_analyzed"==e.id));o>-1&&a.errors.splice(o,1),null!=this.version.files[i].sha256sum&&null!=this.version.files[i].byteSize||this.version.files[i].errors.push({id:"err_file_not_analyzed",message:"This file has not been analyzed yet. Press the eye icon to analyze the file."}),this.version.files[i].errors.length>0&&(e=!0)}this.hasConfigurationError=e}addFile(e){for(var t in null==this.version.files&&(this.version.files=[]),this.version.files)if(e.url==this.version.files[t].url)return;var i=e.url,a=i.split("/").pop(),o=a.split(".");(a=o[0]).length>32&&(a=a.substr(0,32)+"..."),this.version.files.push({id:i,uri:e.url,name:a,contentVariants:{},sha256:{},format:e.format,compression:e.compression,artifactId:void 0,groupId:void 0}),this.version.files.sort((function(e,t){var i=e.name,a=t.name;return i<a?-1:i>a?1:0})),this.version.isConfigDirty=!0}addContentVariant(e){if(null!=e&&""!=e){for(var t in null==this.version.contentVariants&&(this.version.contentVariants=[]),this.version.contentVariants)if(this.version.contentVariants[t].id==e)return;this.version.contentVariants.push({label:e,id:e}),this.version.isConfigDirty=!0}}removeContentVariant(e){for(var t in this.version.contentVariants=this.version.contentVariants.filter((function(t){return t.id!=e.id})),this.version.files){delete this.version.files[t].contentVariants[e.id]}this.version.isConfigDirty=!0}createVersionId(e){0==e&&(this.version.id=(new Date).toISOString().slice(0,10)),1==e&&(this.version.id=(new Date).toISOString().slice(0,13))}getRowIndex(e,t){var i=1;for(var a in e){if(e[a].name==t)return i;i++}return-1}cvSplit(e,t,i){if(!(t.length<=1))if(null==e.contentVariants&&(e.contentVariants=[]),i-2>=e.contentVariants.length){if(t.length>1){var a=[];if(0==e.contentVariants.length)a.push("No content variants have been added yet. Add content variants in the artifact panel in order to tag your files.");else for(var o in e.contentVariants){var n=e.contentVariants[o],r=t[0].contentVariants[n.id];null!=r&&""!=r||(r="none"),a.push(n.id+": "+r)}for(var s in t){var l=0;if(0==s)l=this.getRowIndex(e.files,t[1].name);else l=this.getRowIndex(e.files,t[0].name);var c="Content variants of files need to be unique. Duplicate content variant setting found at row "+l+" ("+a.join(", ")+").";t[s].errors.push({key:"err_duplicate_file",message:c})}}}else{var u={};for(var s in t){var d=t[s],h=null;null!=(h=0==i?d.format:1==i?d.compression:d.contentVariants[e.contentVariants[i-2].id])&&""!=h||(h="$_none$"),null==u[h]&&(u[h]=[]),u[h].push(d)}for(var f in u)this.cvSplit(e,u[f],i+1)}}getOrCreateFileGroup(e,t){return null==this.version.files&&(this.version.files={}),null==this.version.files[e]&&(this.version.files[e]={id:e,name:t,contentVariants:{},distributions:[],artifactId:void 0,groupId:void 0}),this.version.files[e]}}const FACET_DEFAULT_SUBQUERY="\n\t{ \n\t\t?distribution <%FACET%> '%VALUE%'^^<http://www.w3.org/2001/XMLSchema#string> . \n\t} ",FACET_DEFAULT_SUBQUERY_PLACEHOLDER_FACET="%FACET%",FACET_DEFAULT_SUBQUERY_PLACEHOLDER_VALUE="%VALUE%",FACET_VERSION_KEY="http://purl.org/dc/terms/hasVersion",FACET_LATEST_VERSION_VALUE="$latest",FACET_LATEST_VERSION_LABEL="Latest Version",FACET_LASTEST_ARTIFACT_VERSION_SUBQUERY="\n\t{\n\t\t?distribution dct:hasVersion ?latestVersion \n\t\t{\n\t\t\tSELECT (?version as ?latestVersion) WHERE { \n\t\t\t\t?dataset dataid:artifact <%ARTIFACT_URI%> . \n\t\t\t\t?dataset dct:hasVersion ?version . \n\t\t\t} ORDER BY DESC (?version) LIMIT 1 \n\t\t} \n\t}",FACET_LASTEST_GROUP_VERSION_SUBQUERY="\n\t{\n\t\t?distribution dct:hasVersion ?latestVersion \n\t\t{\n\t\t\tSELECT (?version as ?latestVersion) WHERE { \n\t\t\t\t?dataset dataid:group <%ARTIFACT_URI%> . \n\t\t\t\t?dataset dct:hasVersion ?version . \n\t\t\t} ORDER BY DESC (?version) LIMIT 1 \n\t\t} \n\t}",FACET_SUBQUERY_UNION="\n\tUNION",DATABUS_RESOURCE_BASE_URL="http://localhost:3000",DATABUS_DEFAULT_CONTEXT_URL="none",DATABUS_SPARQL_ENDPOINT_URL="/system/sparql",DATABUS_QUERIES={collectionStatistics:"\nPREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nSELECT DISTINCT \n  ?dataset\n  ?file\n  ?license\n  ?size\nWHERE { \n  %COLLECTION_QUERY%\n  OPTIONAL { ?dataset dct:license ?license . }\n  ?dataset dcat:distribution ?distribution .\n  ?distribution dataid:file ?file .\n  OPTIONAL { ?distribution dcat:byteSize ?size . }\n}\n",collectionFiles:"\nPREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nSELECT DISTINCT \n  ?versionUri\n  ?dataset\n  ?distribution\n  ?label    \n  ?comment\n  (GROUP_CONCAT(DISTINCT ?file; SEPARATOR=\", \") AS ?files)\n  ?license\n  ?size\n  ?version\n  ?format\n  (GROUP_CONCAT(DISTINCT ?var; SEPARATOR=', ') AS ?variant)\n  ?preview\nWHERE { \n  %COLLECTION_QUERY%\n  ?distribution dataid:file ?file .\n  ?distribution dataid:formatExtension ?format .\n  OPTIONAL { ?distribution ?p  ?var. ?p rdfs:subPropertyOf dataid:contentVariant . }\n  OPTIONAL { ?dataset dct:license ?license . }\n  OPTIONAL { ?distribution dcat:byteSize ?size . }\n  OPTIONAL { ?distribution dataid:preview ?preview . }\n  ?distribution dct:hasVersion ?version .\n  ?dataset dcat:distribution ?distribution .\n  ?dataset dataid:version ?versionUri .\n  ?dataset dct:title ?label .\n  ?dataset dct:abstract ?comment.\n}\nGROUP BY ?versionUri ?dataset ?distribution ?label ?comment ?license ?size ?version ?format ?preview",nodeFileList:"\nPREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nSELECT DISTINCT \n  ?file\n  ?license\n  ?size\n  ?format\n  ?compression\n  (GROUP_CONCAT(DISTINCT ?var; SEPARATOR=', ') AS ?variant)\n  ?preview\nWHERE { \n  ?dataset dcat:distribution ?distribution .\n  %COLLECTION_QUERY%\n  ?distribution dataid:file ?file .\n  ?distribution dataid:formatExtension ?format .\n  ?distribution dataid:compression ?compression .\n  OPTIONAL { ?distribution ?p  ?var. ?p rdfs:subPropertyOf dataid:contentVariant . }\n  OPTIONAL { ?dataset dct:license ?license . }\n  OPTIONAL { ?distribution dcat:byteSize ?size . }\n  OPTIONAL { ?distribution dataid:preview ?preview . }\n}\nGROUP BY ?file?license ?size ?format ?compression ?preview"};var DatabusResponse={COLLECTION_CREATED:2e3,COLLECTION_UPDATED:2001,COLLECTION_PUBLISHED:2002,COLLECTION_UNPUBLISHED:2003,COLLECTION_DELETED:2004,COLLECTION_DRAFT_CREATED:2006,COLLECTION_QUERY_COPIED_TO_CLIPBOARD:2007,COLLECTION_LOCAL_CHANGES_DISCARDED:2008,COLLECTION_DOWNLOAD_URLS_COPIED_TO_CLIPBOARD:2009,COLLECTION_BASH_COPIED_TO_CLIPBOARD:2010,COLLECTION_IMPORTED:2011,COLLECTION_INVALID_ID:4e3,COLLECTION_UPDATE_ERROR:4001,COLLECTION_BAD_REQUEST:4002,COLLECTION_MISSING_LABEL:4010,COLLECTION_INVALID_LABEL:4011,COLLECTION_MISSING_ABSTRACT:4012,COLLECTION_INVALID_ABSTRACT:4013,COLLECTION_MISSING_DESCRIPTION:4014,COLLECTION_INVALID_DESCRIPTION:4015,COLLECTION_IMPORTED_FAILED:4016,ACCOUNT_ALREADY_EXISTS:4030,ACCOUNT_ACCESS_DENIED:4031,ACCOUNT_INVALID_PERSON_IDENTIFIER:4032,ACCOUNT_PERSON_GRAPH_MISSING:4033,Message:{2e3:"A new collection has been created.",2001:"Your collection has been saved remotely.",2002:"Your collection is now visible.",2003:"Your collection is now hidden.",2004:"Collection deleted.",2006:"A new draft has been created",2007:"The collection query has been copied to the clipboard",2008:"Your local changes have been discarded.",2009:"The collection download URLs have been copied to the clipboard",2010:"The download script has been copied to the clipboard",2011:"Collection imported successfully.",4e3:"Invalid collection id. Please use only lower case letters, numbers, underscores or dashes.",4001:"Saving the collection failed. Please try again later.",4002:"Failed to create the requested identifiers.",4010:"The label field is required.",4011:"Please enter at most 200 characters. The label should not contain any special characters except '(' and ')'.",4012:"The abstract field is required",4013:"Please enter at least 50 and at most 500 characters.",4014:"The description field is required",4015:"Please enter at least 50 characters.",4030:"An account with this name already exists",4031:"You are not allowed to do that.",4032:"The specified person identifier does not match the account",4033:"No graph with person data found.",4016:"Collection JSON import failed."}};"object"==typeof module&&module&&module.exports&&(module.exports=DatabusResponse);class DatabusUtils{static isValidResourceIdentifier(e,t){return this.checkField(e,/^[a-z-]+$/,t,50)}static isValidVersionIdentifier(e){return this.checkField(e,/^[A-Za-z0-9_\-]*$/,3,50)}static isValidResourceText(e,t,i){return this.checkField(e,/^[\x00-\x7F\n]*$/,t,i)}static isValidAccountName(e){return this.checkField(e,/^[a-z][a-z_\-]+[a-z]$/,3,10)}static isValidUrl(e){return/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/g.test(e)}static isValidResourceLabel(e,t,i){return this.checkField(e,/^[A-Za-z0-9\s_()\.\,\-]*$/,t,i)}static objSize(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i}static uniqueList(e){for(var t={},i=[],a=0,o=e.length;a<o;++a)t.hasOwnProperty(e[a])||(i.push(e[a]),t[e[a]]=1);return i}static formatFileSize(e){return null==e?"0 KB":e<1024?e+" B":e<1048576?Math.round(e/1024)+" KB":e<1073741824?Math.round(10*e/1048576)/10+" MB":Math.round(100*e/1073741824)/100+" GB"}static checkField(e,t,i,a){return null!=e&&(!(a>0&&e.length>a)&&(!(e.length<i)&&t.test(e)))}static uuidv4(){return"___xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}static tryParseJson(e){return JSON.parse(e)}static uriToName(e){if(null==e)return null;var t=e.substr(e.lastIndexOf("/")+1);return(t=t.substr(t.lastIndexOf("#")+1)).includes(".")&&(t=t.substr(0,t.lastIndexOf("."))),t}static navigateUp(e,t){null==t&&(t=1);for(var i=0;i<t;i++)e=e.substr(0,e.lastIndexOf("/"));return e.includes("#")&&(e=e.substr(0,e.lastIndexOf("#"))),e}static copyStringToClipboard(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style={position:"absolute",left:"-9999px"},document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}static serialize(e,t){return null==t&&(t=["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published"]),JSON.stringify(e,(function(e,i){if(!t.includes(e))return i}))}static createCleanCopy(e){return JSON.parse(DatabusCollectionUtils.serialize(e))}static exportToJsonFile(e){let t=DatabusCollectionUtils.serialize(e,["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published","uuid"]),i="data:application/json;charset=utf-8,"+encodeURIComponent(t),a=document.createElement("a");a.setAttribute("href",i),a.setAttribute("download","data.json"),a.click()}}"object"==typeof module&&module&&module.exports&&(module.exports=DatabusUtils);const JSONLD_CONTEXT={dataid:"http://dataid.dbpedia.org/ns/core#",databus:"https://databus.dbpedia.org/system/ontology#","dataid-cv":"http://dataid.dbpedia.org/ns/cv#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",dct:"http://purl.org/dc/terms/",dcat:"http://www.w3.org/ns/dcat#",xsd:"http://www.w3.org/2001/XMLSchema#",cert:"http://www.w3.org/ns/auth/cert#",dbo:"http://dbpedia.org/ontology/",foaf:"http://xmlns.com/foaf/0.1/",sec:"https://w3id.org/security#",maker:{"@id":"foaf:maker","@type":"@id"},primaryTopic:{"@id":"foaf:primaryTopic","@type":"@id"},name:{"@id":"foaf:name","@type":"xsd:string"},account:{"@id":"foaf:account","@type":"@id"},img:{"@id":"foaf:img","@type":"@id"},key:{"@id":"cert:key"},modulus:{"@id":"cert:modulus"},exponent:{"@id":"cert:exponent"},title:{"@id":"dct:title","@type":"xsd:string"},label:{"@id":"rdfs:label","@type":"xsd:string"},comment:{"@id":"rdfs:comment","@type":"xsd:string"},abstract:{"@id":"dct:abstract","@type":"xsd:string"},description:{"@id":"dct:description","@type":"xsd:string"},issued:{"@id":"dct:issued","@type":"xsd:dateTime"},modified:{"@id":"dct:modified","@type":"xsd:dateTime"},license:{"@id":"dct:license","@type":"@id"},publisher:{"@id":"dct:publisher","@type":"@id"},distribution:{"@id":"dcat:distribution","@type":"@id"},downloadURL:{"@id":"dcat:downloadURL","@type":"@id"},file:{"@id":"dataid:file","@type":"@id"},byteSize:{"@id":"dcat:byteSize","@type":"xsd:decimal"},group:{"@id":"dataid:group","@type":"@id"},Group:"dataid:Group",Dataset:"dataid:Dataset",Artifact:"dataid:Artifact",artifact:{"@id":"dataid:artifact","@type":"@id"},version:{"@id":"dataid:version","@type":"@id"},hasVersion:{"@id":"dct:hasVersion","@type":"xsd:string"},formatExtension:{"@id":"dataid:formatExtension","@type":"xsd:string"},format:{"@id":"dataid:formatExtension","@type":"xsd:string"},compression:{"@id":"dataid:compression","@type":"xsd:string"},sha256sum:{"@id":"dataid:sha256sum","@type":"xsd:string"},signature:{"@id":"dataid:signature","@type":"xsd:string"},tractate:{"@id":"databus:tractate","@type":"xsd:string"}};!function(e){"use strict";var t=function(e){if("string"!=typeof e)return 0;var t=e.match(/\d/g);return t?Math.min.apply(null,t):1},i=function(e){var i,a,o=e.selector,n=e.scope,r=document.createElement("ol"),s=r,l=null,c=(i=e.overwrite,a=e.prefix,function(e,t,o){var n=e.textContent,r=a+"-"+o;t.textContent=n;var s=i?r:e.id||r;s=encodeURIComponent(s),e.id=s,t.href="#"+s});return function(e,t){var i=[],a=document.querySelectorAll(t);return Array.prototype.forEach.call(a,(function(t){var a=t.querySelectorAll(e);i=i.concat(Array.prototype.slice.call(a))})),i}(o,n).reduce((function(e,i,a){var o=t(i.tagName),n=o-e;n>0&&(s=function(e,t){for(;t--;)e=e.appendChild(document.createElement("ol")),t&&(e=e.appendChild(document.createElement("li")));return e}(l,n)),n<0&&(s=function(e,t){for(;t--;)e=e.parentElement;return e}(s,2*-n)),s=s||r;var u=document.createElement("li"),d=document.createElement("a");return c(i,d,a),s.appendChild(u).appendChild(d),l=u,o}),t(o)),r},a=function(e){var t=(e=function(e,t){for(var i in t)t.hasOwnProperty(i)&&t[i]&&(e[i]=t[i]);return e}({selector:"h1, h2, h3, h4, h5, h6",scope:"body",overwrite:!1,prefix:"toc"},e)).selector;if("string"!=typeof t)throw new TypeError("selector must be a string");if(!t.match(/^(?:h[1-6],?\s*)+$/g))throw new TypeError("selector must contains only h1-6");var a=location.hash;return a&&setTimeout((function(){var e=document.getElementById(a.slice(1));e&&e.scrollIntoView()}),0),i(e)};"function"==typeof define&&define.amd?define((function(){return a})):e.initTOC=a}(window);